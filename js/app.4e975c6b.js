(function(e){function t(t){for(var i,o,r=t[0],c=t[1],l=t[2],u=0,p=[];u<r.length;u++)o=r[u],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&p.push(a[o][0]),a[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);d&&d(t);while(p.length)p.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],i=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(i=!1)}i&&(s.splice(t--,1),e=r(r.s=n[0]))}return e}var i={},a={app:0},s=[];function o(e){return r.p+"js/"+({}[e]||e)+"."+{"chunk-0df9c034":"64cce74a","chunk-2d0e1d75":"a5e6dd93","chunk-7e07bcb6":"a5e0565e"}[e]+".js"}function r(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.e=function(e){var t=[],n=a[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise((function(t,i){n=a[e]=[t,i]}));t.push(n[2]=i);var s,c=document.createElement("script");c.charset="utf-8",c.timeout=120,r.nc&&c.setAttribute("nonce",r.nc),c.src=o(e);var l=new Error;s=function(t){c.onerror=c.onload=null,clearTimeout(u);var n=a[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+i+": "+s+")",l.name="ChunkLoadError",l.type=i,l.request=s,n[1](l)}a[e]=void 0}};var u=setTimeout((function(){s({type:"timeout",target:c})}),12e4);c.onerror=c.onload=s,document.head.appendChild(c)}return Promise.all(t)},r.m=e,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/adeditor/",r.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var d=l;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0cd4":function(e,t,n){},1:function(e,t){},"15e9":function(e,t,n){},2:function(e,t){},"50cd":function(e,t,n){"use strict";var i=n("0cd4"),a=n.n(i);a.a},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),a=(n("b774"),n("e37d")),s=(n("ba8c"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"flex flex-row h-screen w-screen items-stretch",attrs:{id:"app"}},[n("div",{staticClass:"flex flex-grow-0 flex-col items-stretch p-2",staticStyle:{width:"16em"}},[n("Card",{staticClass:"flex-grow-0 mb-2",scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Files ")]},proxy:!0}])},[n("LoadRoute",{attrs:{cansave:!e.mapLoading&&!!e.editor},on:{"loading-status":function(t){e.mapLoading=t},"map-image-change":function(t){e.mapImageURL=t},"map-xml-loaded":e.mapLoaded,"save-map":e.saveMap}}),e.error?n("div",{staticClass:"flex"},[n("span",{staticClass:"text-red-600 font-bold w-full ",domProps:{textContent:e._s(e.error)}})]):e._e()],1),!e.mapLoading&&e.editor?[e.editor.selection.length?n("Card",{staticClass:"flex-grow-0 mb-2",attrs:{collapsable:!1},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Selected items ")]},proxy:!0}],null,!1,982736498)},[n("ul",e._l(e.editor.selection.filter((function(e){return e})),(function(t,i){return n("li",{key:i,staticClass:"hover:bg-pink-300",on:{mouseenter:function(n){return e.mouseOver("selection",n,{item:t,selIndex:i})},mouseleave:function(n){return e.mouseOver("selection",n,{item:t,selIndex:i})}}},[t.waypoint?[n("span",[e._v("Waypoint # "+e._s(t.waypoint.index))]),t.waypoint.marker?n("span",{staticClass:"ml-1 font-bold",domProps:{textContent:e._s(t.waypoint.marker.name)}}):e._e()]:e._e(),t.branch?[n("span",[e._v("Branch # "+e._s(t.branch.index)+" ("+e._s(t.branch.wpts.length)+" wpts)")])]:e._e()],2)})),0)]):e._e(),n("Card",{staticClass:"flex-grow mb-2",attrs:{collapsable:!1},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Tools ")]},proxy:!0}],null,!1,1256915702)},e._l(e.editor.toolsAvailable,(function(t){return n("div",{key:t.action,staticClass:"flex flex-col self-stretch mb-1",class:{dropdown:t.options}},[n("button",{directives:[{name:"tooltip",rawName:"v-tooltip.right",value:t.description,expression:"toolInstance.description",modifiers:{right:!0}}],staticClass:"inline-flex items-stretch bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-1 px-2 rounded",on:{mouseenter:function(n){t.options||e.mouseOver("toolInstance",n,{toolInstance:t})},mouseleave:function(n){t.options||e.mouseOver("toolInstance",n,{toolInstance:t})},click:function(n){t.options||e.toolAction(t)}}},[n("span",{staticClass:"material-icons fill-current mr-1",domProps:{textContent:e._s(t.icon)}}),n("span",{domProps:{textContent:e._s(t.label)}}),t.options?n("span",[e._v("ðŸ ‹")]):e._e()]),t.options?n("ul",{staticClass:"flex flex-col self-stretch dropdown-content absolute hidden text-gray-800 pt-1 mt-8"},e._l(t.options,(function(i){return n("li",{key:i.index,staticClass:"flex block self-stretch"},[n("button",{directives:[{name:"tooltip",rawName:"v-tooltip.right",value:i.description,expression:"option.description",modifiers:{right:!0}}],staticClass:"flex w-full items-stretch bg-gray-300 hover:bg-gray-400 p-1 whitespace-no-wrap",on:{mouseenter:function(n){return e.mouseOver("toolInstance",n,{toolInstance:t,option:i})},mouseleave:function(n){return e.mouseOver("toolInstance",n,{toolInstance:t,option:i})},click:function(n){return e.toolAction(t,i)}}},[i.icon?n("span",{staticClass:"material-icons fill-current mr-1",domProps:{textContent:e._s(i.icon)}}):e._e(),n("span",{domProps:{textContent:e._s(i.label)}})])])})),0):e._e()])})),0),e.editor&&(e.editor.actions.length||e.editor.redoables.length)?n("Card",{staticClass:"flex-grow-0",scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Undo/Redo ")]},proxy:!0}],null,!1,382143710)},[n("div",{staticClass:"flex flex-row"},[n("div",{staticClass:"flex-1 m-1"},[e.editor.actions.length?n("button",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:e.editor.actions.slice(-1)[0].label,expression:"editor.actions.slice(-1)[0].label",modifiers:{top:!0}}],staticClass:"w-full border shadow",on:{click:e.undo}},[e._v(" Undo ")]):e._e()]),n("div",{staticClass:"flex-1 m-1"},[e.editor.redoables.length?n("button",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:e.editor.redoables.slice(-1)[0].label,expression:"editor.redoables.slice(-1)[0].label",modifiers:{top:!0}}],staticClass:"w-full  border shadow",on:{click:e.redo}},[e._v(" Redo ")]):e._e()])])]):e._e(),n("Card",{staticClass:"flex-grow-0",scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Info ")]},proxy:!0}],null,!1,727986227)},[n("div",{staticClass:"flex flex-col text-sm"},[n("span",{staticClass:"flex text-center"},[n("label",{staticClass:"mr-1",attrs:{for:"mapsize"}},[e._v("Map Size")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.editor.map.size,expression:"editor.map.size"}],attrs:{type:"number",id:"mapsize",list:"sizes"},domProps:{value:e.editor.map.size},on:{input:function(t){t.target.composing||e.$set(e.editor.map,"size",t.target.value)}}}),n("datalist",{attrs:{id:"sizes"}},e._l(e.defaultMapSizes,(function(t,i){return n("option",{key:i,domProps:{value:i,textContent:e._s(t)}})})),0),e.factor?n("span",{staticClass:"ml-1"},[e._v("("+e._s(e.factor)+")")]):e._e()]),n("span",{staticClass:"flex text-center"},[e._v(" Waypoints: "+e._s(e.editor.map.waypointsArray().length)+" ")]),n("span",{staticClass:"flex text-center"},[e._v(" Branches: "+e._s(e.editor.map.branches.length)+" ")])])])]:e._e(),n("Card",[n("div",{staticClass:"text-xs"},[e._v(" For info and help see "),n("a",{staticClass:"font-semibold text-gray-700 underline hover:text-gray-800 hover:no-underline",attrs:{href:"https://github.com/manierim/adeditor#main-features",target:"_blank"}},[e._v("readme on GitHub")])])])],2),!e.mapLoading&&e.editor?n("Map",{staticClass:"flex flex-grow border border-gray-400 rounded shadow-md m-2 ml-0 p-2",attrs:{mapImageURL:e.mapImageURL,editor:e.editor,selection:e.selectionWithHL},on:{"map-click":e.mapClick,"branch-click":e.branchClick,"wpt-click":e.wptClick,"wpt-dragged":e.wptDragged}}):e._e()],1)}),o=[],r=(n("d81d"),n("96cf"),n("1da1")),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"form flex flex-col text-sm"},[n("div",{staticClass:"flex flex-col mb-2"},[!e.loading&&e.cansave?[n("button",{staticClass:"w-full border shadow",on:{click:function(t){return e.$emit("save-map")}}},[e._v(" Save ")])]:[n("span",{staticClass:"flex text-xs"},[e._v("XML")]),n("input",{staticClass:"flex text-xs",attrs:{disabled:e.loading,type:"file"},on:{change:e.getFile}})]],2),n("div",{staticClass:"flex flex-col"},[e._m(0),n("input",{staticClass:"flex text-xs",attrs:{type:"file"},on:{change:e.getImage}}),e.savePng?[n("a",{staticClass:"w-full border shadow text-center text-xs my-1",attrs:{download:e.saveName.substring(0,e.saveName.length-4)+".png",href:e.savePng}},[e._v(" Download PNG ")]),n("p",{staticClass:"flex text-xs italic"},[e._v(" Conversion from DDS requires time. It is suggested to downnoald the converted PNG image and use it in future. ")])]:e._e()],2)])},l=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",{staticClass:"flex text-xs"},[n("span",[e._v("Image")]),n("span",{staticClass:"italic ml-1"},[e._v("(.dds from map or converted .png)")])])}],u=(n("b0c0"),n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),n("4de4"),n("4160"),n("c975"),n("fb6a"),n("90d7"),n("4fad"),n("ac1f"),n("1276"),n("159b"),n("d4ec")),d=n("bee2"),p=n("ade3"),h=(n("99af"),n("6062"),n("2909")),f=function(){function e(t,n,i,a,s,o,r){Object(u["a"])(this,e),Object(p["a"])(this,"map",void 0),Object(p["a"])(this,"index",void 0),Object(p["a"])(this,"x",void 0),Object(p["a"])(this,"y",void 0),Object(p["a"])(this,"z",void 0),Object(p["a"])(this,"marker",void 0),Object(p["a"])(this,"ins",void 0),Object(p["a"])(this,"outs",void 0),this.map=t,this.index=parseInt(n),this.x=parseFloat(i),this.y=parseFloat(a),this.z=parseFloat(s),this.marker=null,this.ins=o,this.outs=r}return Object(d["a"])(e,[{key:"inFromOuts",value:function(){var e=this;return void 0===this.map.cache["inFromOuts"]&&(this.map.cache["inFromOuts"]={},this.map.waypointsArray().forEach((function(t){e.map.cache["inFromOuts"][t.index]||(e.map.cache["inFromOuts"][t.index]=[]),t.existingOuts().forEach((function(n){e.map.cache["inFromOuts"][n]||(e.map.cache["inFromOuts"][n]=[]),e.map.cache["inFromOuts"][n].push(t.index)}))}))),this.map.cache["inFromOuts"]}},{key:"_cache_check",value:function(){void 0===this.map.cache["wpts"]&&(this.map.cache["wpts"]={}),void 0===this.map.cache["wpts"][this.index]&&(this.map.cache["wpts"][this.index]={})}},{key:"set",value:function(e,t){this._cache_check(),this.map.cache["wpts"][this.index][e]=t}},{key:"get",value:function(e,t){return this._cache_check(),void 0!==this.map.cache["wpts"][this.index][e]?this.map.cache["wpts"][this.index][e]:t}},{key:"linksofType",value:function(e){var t=this,n=this.get("linksofType");return void 0===n&&(n={},["in","out","bidirectional","reverse-in","reverse-out"].forEach((function(e){n[e]=t.linkedWpts().filter((function(n){return t.linkType(n)===e}))})),this.set("linksofType",n)),void 0!==e?n[e]:n}},{key:"existingIns",value:function(){var e=this,t=this.get("existingIns");return void 0===t&&(t=this.ins.filter((function(t){return e.map.waypoints[t]})),this.set("existingIns",t)),t}},{key:"existingOuts",value:function(){var e=this,t=this.get("existingOuts");return void 0===t&&(t=this.outs.filter((function(t){return e.map.waypoints[t]})),this.set("existingOuts",t)),t}},{key:"linkType",value:function(e){var t="linkType-"+e,n=this.get(t);return void 0===n&&(n=null,-1!==this.linkedWpts().indexOf(e)&&(n="in",n=-1!==this.existingOuts().indexOf(e)&&-1!==this.existingIns().indexOf(e)?"bidirectional":-1!==this.existingIns().indexOf(e)&&-1!==this.map.waypoints[e].existingOuts().indexOf(this.index)?"in":-1!==this.existingOuts().indexOf(e)&&-1!==this.map.waypoints[e].existingIns().indexOf(this.index)?"out":-1!==this.existingOuts().indexOf(e)?"reverse-out":"reverse-in"),this.set(t,n)),n}},{key:"isNode",value:function(){var e=this.get("isNode");if(void 0===e){e=!0;var t=this.linkedWpts();2===t.length&&(e=!("in"===this.linkType(t[0])&&"out"===this.linkType(t[1])||"out"===this.linkType(t[0])&&"in"===this.linkType(t[1])||"reverse-out"===this.linkType(t[0])&&"reverse-in"===this.linkType(t[1])||"reverse-in"===this.linkType(t[0])&&"reverse-out"===this.linkType(t[1])||"bidirectional"===this.linkType(t[0])&&"bidirectional"===this.linkType(t[1]))),this.set("isNode",e)}return e}},{key:"linkedWpts",value:function(){var e=this.get("linkedWpts");return void 0===e&&(e=Object(h["a"])(new Set([].concat(Object(h["a"])(this.existingIns()),Object(h["a"])(this.existingOuts()),Object(h["a"])(this.inFromOuts()[this.index])))),this.set("linkedWpts",e)),e}},{key:"branches",value:function(){return this.get("branches",[])}},{key:"addBranch",value:function(e){var t=this.get("branches",[]);t.push(e),this.set("branches",t)}}]),e}(),m=function(){function e(t){var n=this;Object(u["a"])(this,e),Object(p["a"])(this,"parser",void 0),Object(p["a"])(this,"cache",void 0),Object(p["a"])(this,"waypoints",void 0),Object(p["a"])(this,"size",void 0),Object(p["a"])(this,"branches",void 0),Object(p["a"])(this,"lastid",void 0),this.parser=t,this.cache={},this.waypoints={},this.lastid=0;for(var i=this.parser.parse(),a=0,s=0;s<i.x.length;s++){Math.abs(i.x[s])>a&&(a=Math.abs(i.x[s])),Math.abs(i.z[s])>a&&(a=Math.abs(i.z[s]));var o=s+1;i.id&&(o=parseInt(i.id[s]));var r=function(e){return e.split(",").map((function(e){return parseInt(e)})).filter((function(e){return e>0}))},c=new f(this,o,parseFloat(i.x[s]),parseFloat(i.y[s]),parseFloat(i.z[s]),r(i.ins[s]),r(i.outs[s]));this.waypoints[o]=c,o>this.lastid&&(this.lastid=o)}var l=2048;a&&(l=2048*Math.pow(2,Math.ceil(Math.log2(Math.ceil(a/1024))))),this.size=l,i.markers.forEach((function(e){n.waypoints[e.index].marker=e})),this.buildBranches()}return Object(d["a"])(e,[{key:"addWaypoint",value:function(e){var t=e.waypoint,n=e.x,a=e.y,s=e.z;if(!t){var o=++this.lastid;t=new f(this,o,parseFloat(n),parseFloat(a),parseFloat(s),[],[])}return i["a"].set(this.waypoints,t.index,t),this.cache["inFromOuts"]&&(this.cache["inFromOuts"][t.index]=[]),t}},{key:"removeWaypoint",value:function(e){if(this.waypoints[e])return i["a"].delete(this.waypoints,e),!0}},{key:"waypointsArray",value:function(){return Object.entries(this.waypoints).map((function(e){return e[1]}))}},{key:"markers",value:function(){return this.waypointsArray().filter((function(e){return e.marker})).map((function(e){return e.marker.wpt=e,e.marker}))}},{key:"save",value:function(){var e=this.parser.getContentForSave(this.waypointsArray(),this.markers()),t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",this.parser.fileName),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}},{key:"buildBranches",value:function(){var e=this;if(this.waypointsArray().length){var t=[];this.cache={};var n=[],i=[],a=function(a){-1===i.indexOf(a.index)&&(i.push(a.index),["bidirectional","out","reverse-out"].forEach((function(i){a.linksofType(i).forEach((function(s){if("bidirectional"!==i||-1===n.indexOf(s)){var o=[a],r=e.waypoints[s];if(r){o.push(r);var c=a;while(r&&!r.isNode()&&r.index!==a.index){c=r;var l=r.linkedWpts().filter((function(e){return e!==o.slice(-2,-1)[0].index}))[0];r=e.waypoints[l],r?o.push(r):console.warn("cannot find waypoint #",l)}"bidirectional"===i&&n.push(c.index);var u={index:t.length,bidirectional:"bidirectional"===i,reverse:"reverse-out"===i,wpts:o};o.forEach((function(e){e.addBranch(u)})),t.push(u)}else console.warn("cannot find waypoint #",s)}}))})))},s=[];this.waypointsArray().forEach((function(t){if(t.linkedWpts().length&&-1===s.indexOf(t.index)){var n=[],i=null;while(!t.isNode()&&-1===n.indexOf(t.index)){s.push(t.index),n.push(t.index);var o=t.linkedWpts()[0];null!==i&&o===i&&(o=t.linkedWpts()[1]),i=t.index,t=e.waypoints[o]}a(t)}})),this.branches=t}else this.branches=[]}}]),e}();function v(e,t){return g.apply(this,arguments)}function g(){return g=Object(r["a"])(regeneratorRuntime.mark((function e(t,i){var a,s,o,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={map:null,error:null},s=n("083c").parseStringPromise,e.prev=2,e.next=5,s(t);case 5:o=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e["catch"](2),a.error=e.t0,e.abrupt("return",a);case 12:if(!o.AutoDrive){e.next=16;break}return e.next=15,n.e("chunk-7e07bcb6").then(n.bind(null,"6586"));case 15:r=e.sent;case 16:if(!o.routeExport){e.next=20;break}return e.next=19,n.e("chunk-2d0e1d75").then(n.bind(null,"7bc7"));case 19:r=e.sent;case 20:if(r){e.next=23;break}return a.error="File format not recognized",e.abrupt("return",a);case 23:return a.map=new m(new r.default(o,i)),e.abrupt("return",a);case 25:case"end":return e.stop()}}),e,null,[[2,8]])}))),g.apply(this,arguments)}var x,y=function(){return n.e("chunk-0df9c034").then(n.bind(null,"e01f"))},b={name:"LoadRoute",data:function(){return{loading:!1,savePng:null,saveName:null}},props:{cansave:Boolean},methods:{loadingStatus:function(e){e!==this.loading&&(this.loading=e,this.$emit("loading-status",e))},getImage:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var i,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:"image/vnd.ms-dds"===e.target.files[0].type&&(a=new FileReader,a.onload=function(){var n=Object(r["a"])(regeneratorRuntime.mark((function n(i){var a,s,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,y();case 2:return a=n.sent,s=a.createObjectURLFromDDS,n.next=6,s(i.target.result);case 6:o=n.sent,o&&(t.savePng=o,t.saveName=e.target.files[0].name,t.$emit("map-image-change",o));case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),a.readAsArrayBuffer(e.target.files[0])),"image/png"===e.target.files[0].type&&(i=URL.createObjectURL(e.target.files[0]),i&&(t.savePng=null,t.$emit("map-image-change",i)));case 2:case"end":return n.stop()}}),n)})))()},getFile:function(e){var t=this;this.loadingStatus(!0);var n=e.target.files[0],i=new FileReader;i.onload=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loadingStatus(!1),e.t0=t,e.next=4,v(i.target.result,n.name);case 4:e.t1=e.sent,e.t0.$emit.call(e.t0,"map-xml-loaded",e.t1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.readAsText(n)}}},w=b,k=n("2877"),_=Object(k["a"])(w,c,l,!1,null,"2527257c",null),O=_.exports,z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("svg",{ref:"svgMap",staticClass:"flex flex-grow bg-gray-200",attrs:{id:"svgMap"},on:{mousemove:e.mapMouseMove}},[n("g",{staticClass:"svg-pan-zoom_viewport"},[n("g",{attrs:{"pointer-events":"fill"},on:{mousedown:e.mouseBtn,mouseup:e.mouseBtn,mousemove:e.mouseBtn}},[n("polygon",{staticClass:"mapbounds",attrs:{id:"mapbounds",fill:"transparent",points:e.mapBoundsPoints}}),e.mapImageURL?n("image",{attrs:{x:-e.editor.map.size/2,y:-e.editor.map.size/2,width:e.editor.map.size,height:e.editor.map.size,href:e.mapImageURL}}):e._e()]),n("g",{staticClass:"targets"},e._l(e.editor.map.markers(),(function(t){return n("text",{key:t.index,staticClass:"marker-label",attrs:{"text-anchor":"middle",x:t.wpt.x,y:t.wpt.z-4}},[e._v(" "+e._s(t.name)+" "),t.folder?n("title",{domProps:{textContent:e._s(t.folder)}}):e._e()])})),0),n("g",{staticClass:"branches"},[n("defs",[n("marker",{attrs:{id:"arrow",markerWidth:".5",markerHeight:".5",refX:"-.4",refY:".25",orient:"auto",markerUnits:"strokeWidth"}},[n("path",{attrs:{d:"M0,0 L.5,.25 L0,.5"}})])]),e._l(e.drawnBranches,(function(t,i){return n("g",{key:i},[e.debug?n("title",[e._v("branch # "+e._s(i))]):e._e(),n("path",{staticClass:"branch",class:t.bidirectional?"bidirectional":t.reverse?"reverse":"unidirectional",attrs:{d:t.d},on:{click:function(n){return e.$emit("branch-click",{event:n,branch:t.original})}}})])})),e.branchsInEditing?n("g",{staticClass:"editing"},e._l(e.branchsInEditing,(function(e){return n("path",{key:e.sindex,staticClass:"branch",attrs:{d:e.d}})})),0):e._e()],2),n("g",{staticClass:"waypoints"},e._l(e.editor.map.waypointsArray(),(function(t){return n("g",{key:t.index},[e.debug||t.marker?n("title",[e._v(" "+e._s(t.marker?(t.marker.folder?t.marker.folder+" / ":"")+t.marker.name+(e.debug?" | ":""):"")+" "+e._s(e.debug?"wpt # "+t.index+" @ "+t.x.toFixed(3)+", "+t.z.toFixed(3)+" ("+t.y.toFixed(3)+")\nBranches:\n"+t.branches().map((function(e){return"# "+e.index})).join("\n"):"")+" ")]):e._e(),n("circle",{class:[t.isNode()?"node":"waypoint",{marker:!!t.marker,draggable:e.wptDragging&&e.wptDragging.dragged&&e.wptDragging.waypoint===t}],attrs:{cx:t.x,cy:t.z,r:t.marker?1.2:t.isNode()?.5:.3},on:{mousedown:function(n){return n.target!==n.currentTarget?null:(n.stopPropagation(),e.wptMouseBtn({event:n,waypoint:t}))},mouseup:function(n){return n.target!==n.currentTarget?null:(n.stopPropagation(),e.wptMouseBtn({event:n,waypoint:t}))},mousemove:function(t){return t.target!==t.currentTarget?null:(t.stopPropagation(),e.mapMouseMove(t))}}})])})),0),n("g",{staticClass:"selection"},[e._l(e.selectedBranches,(function(t,i){var a=t.branch,s=t.highlight;return n("path",{key:i,staticClass:"branch",class:{highlight:s},attrs:{d:a.d},on:{mouseup:function(t){return e.wptMouseBtn({event:t})}}})})),e._l(e.selectedWpts,(function(t){var i=t.waypoint,a=t.highlight;return n("circle",{key:i.index,staticClass:"waypoint",class:{highlight:a,single:1===e.editor.selection.length&&1===e.selectedWpts.length},attrs:{cx:i.x,cy:i.z,r:i.marker?1.4:i.isNode()?.7:.5}})}))],2),e.editor.preview?n("g",{staticClass:"preview"},[this.editor.preview.line?[n("path",{staticClass:"line",attrs:{d:e.pathDef(this.editor.preview.line)}})]:e._e()],2):e._e()])]),n("div",{staticClass:"absolute object-left-top text-xs"},[n("div",{staticClass:"m-2 p-1 bg-gray-200 border border-gray-700 border-solid rounded"},[e.debug?n("div",[e._v(" Segments drawn: "+e._s(e.segments.reduced)+" of "+e._s(e.segments.total)+" ")]):e._e(),e.mouse?n("div",[e._v(" Mouse @ "+e._s(e.mouse.x.toFixed(3))+" "+e._s(e.mouse.y.toFixed(3))+" ")]):e._e(),e.distance?n("div",[e._v("Distance "+e._s(e.distance.toFixed(3)))]):e._e()])])])},C=[],A=(n("a15b"),n("13d5"),n("a434"),n("b680"),n("c1f9"),n("f8f9")),j=n.n(A),M=n("c8b5"),W=n.n(M),E={controlIconsEnabled:!0,dblClickZoomEnabled:!1,zoomScaleSensitivity:.5,minZoom:5e-4,maxZoom:100,customEventsHandler:{haltEventListeners:["touchstart","touchend","touchmove","touchleave","touchcancel"],init:function(e){var t=e.instance,n=1,i=0,a=0;this.hammer=W()(e.svgElement,{inputClass:W.a.SUPPORT_POINTER_EVENTS?W.a.PointerEventInput:W.a.TouchInput}),this.hammer.get("pinch").set({enable:!0}),this.hammer.on("doubletap",(function(){t.zoomIn()})),this.hammer.on("panstart panmove",(function(e){"panstart"===e.type&&(i=0,a=0),t.panBy({x:e.deltaX-i,y:e.deltaY-a}),i=e.deltaX,a=e.deltaY})),this.hammer.on("pinchstart pinchmove",(function(e){"pinchstart"===e.type&&(n=t.getZoom(),t.zoomAtPoint(n*e.scale,{x:e.center.x,y:e.center.y})),t.zoomAtPoint(n*e.scale,{x:e.center.x,y:e.center.y})})),e.svgElement.addEventListener("touchmove",(function(e){e.preventDefault()}))},destroy:function(){this.hammer.destroy()}}},R=function(){function e(t){Object(u["a"])(this,e),Object(p["a"])(this,"svgElement",void 0),this.svgElement=t,x&&x.destroy(),x=j()(this.svgElement,E)}return Object(d["a"])(e,[{key:"getSvgPoint",value:function(e){var t=e.x,n=e.y,i=this.svgElement.createSVGPoint();return i.x=t,i.y=n,i.matrixTransform(document.getElementsByClassName("svg-pan-zoom_viewport")[0].getCTM().inverse())}},{key:"resize",value:function(){x.resize()}}]),e}(),T={name:"Map",data:function(){return{debug:!0,leftclicking:null,mouse:null,wptDragging:!1}},props:{editor:Object,selection:Array,mapImageURL:String},computed:{distance:function(){return 2===this.selectedWpts.length?Math.sqrt(Math.pow(this.selectedWpts[0].x-this.selectedWpts[1].x,2)+Math.pow(this.selectedWpts[0].z-this.selectedWpts[1].z,2)):null},selectedBranches:function(){var e=this;return this.selection.filter((function(e){return e&&e.branch})).map((function(t){return t.branch.d=e.pathDef(t.branch.wpts),t}))},selectedWpts:function(){return this.selection.filter((function(e){return e&&e.waypoint}))},branchsInEditing:function(){var e=this;return this.wptDragging&&this.wptDragging.dragged&&this.wptDragging.waypoint?this.wptDragging.waypoint.branches().map((function(t,n){return{index:n,d:e.pathDef(t.wpts)}})):null},drawnBranches:function(){var e=this;return this.editor.map.branches.map((function(t){var n=e.reducePath(t.wpts),i=Object.fromEntries(Object.entries(t));return delete i.wpts,i.segments=t.wpts.length-1,i.reducedsegments=n.length-1,i.d=e.pathDef(n),i.original=t,i}))},segments:function(){return this.drawnBranches.reduce((function(e,t){return{total:e.total+t.segments,reduced:e.reduced+t.reducedsegments}}),{total:0,reduced:0})},mapBoundsPoints:function(){return[[-this.editor.map.size/2,-this.editor.map.size/2].join(","),[this.editor.map.size/2,-this.editor.map.size/2].join(","),[this.editor.map.size/2,this.editor.map.size/2].join(","),[-this.editor.map.size/2,this.editor.map.size/2].join(",")].join(" ")}},methods:{pathDef:function(e){return"M"+e.map((function(e){return[e.x,e.z].join(",")})).join(" L")},mapMouseMove:function(e){this.mouse=this.mouseEventMapCoords(e),0===e.button&&this.wptDragging&&(!this.wptDragging.dragged&&Math.pow(e.movementX,2)+Math.pow(e.movementY,2)>9&&(this.wptDragging.dragged=!0),this.wptDragging.dragged&&(this.wptDragging.waypoint.x=+(this.mouse.x-this.wptDragging.offset.x).toFixed(3),this.wptDragging.waypoint.z=+(this.mouse.y-this.wptDragging.offset.y).toFixed(3)))},wptMouseBtn:function(e){var t=e.event,n=e.waypoint;0===t.button&&("mousedown"===t.type&&n&&(this.wptDragging={waypoint:n,offset:{x:this.mouse.x-n.x,y:this.mouse.y-n.z},dragstart:{x:n.x,z:n.z},dragged:!1}),this.wptDragging&&"mouseup"===t.type&&(this.wptDragging.dragged?this.$emit("wpt-dragged",this.wptDragging):n&&this.$emit("wpt-click",{event:t,waypoint:n}),this.wptDragging=!1))},mouseEventMapCoords:function(e){return this.handler.getSvgPoint({x:e.offsetX,y:e.offsetY})},mouseBtn:function(e){0===e.button&&("mousedown"===e.type&&(this.leftclicking=!0),"mousemove"===e.type&&(this.leftclicking=!1),"mouseup"===e.type&&this.leftclicking&&this.$emit("map-click",{event:e,svgpoint:this.mouseEventMapCoords(e)}))},windowResize:function(){this.handler.resize()},reducePath:function(e){function t(e,t,n){var i=t-e.x,a=n-e.z;return Math.sqrt(Math.pow(i,2)+Math.pow(a,2))}function n(e,n,i){var a=i.x-n.x,s=i.z-n.z,o=a*a+s*s;if(0==o)return this.dist(e,n.x,n.z);var r=((e.x-n.x)*a+(e.z-n.z)*s)/o;return r=Math.max(0,Math.min(1,r)),t(e,n.x+r*a,n.z+r*s)}return e.reduce((function(t,i,a){return a<2?(t.push(i),t):(n(e[a-1],t.slice(-2,-1)[0],i)<.15&&t.splice(-1)[0],t.push(i),t)}),[])}},beforeDestroy:function(){window.removeEventListener("resize",this.windowResize)},mounted:function(){this.handler=new R(this.$refs.svgMap),window.addEventListener("resize",this.windowResize)}},B=T,I=(n("50cd"),Object(k["a"])(B,z,C,!1,null,"6941540f",null)),F=I.exports,P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"border border-gray-400 rounded shadow-md p-2 flex flex-col"},[e.hasTitle?n("div",{staticClass:"shadow-inner bg-gray-100 rounded flex mb-2",class:{collapsable:e.collapsable},on:{click:function(t){e.collapsable&&(e.collapsed=!e.collapsed)}}},[n("h2",{staticClass:"w-full text-center font-bold uppercase"},[e._t("title"),e.collapsable?[e.collapsed?n("span",[e._v("â‡“")]):n("span",[e._v("â‡‘")])]:e._e()],2)]):e._e(),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.collapsable||!e.collapsed,expression:"!collapsable || !collapsed"}]},[e._t("default")],2)])},D=[],S={props:{collapsable:{type:Boolean,default:!0}},data:function(){return{collapsed:!1}},computed:{hasTitle:function(){return!!this.$slots.title}}},L=S,K=(n("d555"),Object(k["a"])(L,P,D,!1,null,"9c76647a",null)),N=K.exports;n("a4d3"),n("e01a"),n("7db0"),n("c740"),n("38cf");function $(e,t,n){var i={x:n.x-t.x,z:n.z-t.z},a={x:e.x-t.x,z:e.z-t.z},s=i.x*i.x+i.z*i.z,o=a.x*i.x+a.z*i.z,r=Math.min(1,Math.max(0,o/s));if(0!==r&&1!==r)return{x:t.x+i.x*r,z:t.z+i.z*r}}var U=function(){function e(t){Object(u["a"])(this,e),Object(p["a"])(this,"editor",void 0),this.editor=t}return Object(d["a"])(e,[{key:"addWaypoint",value:function(e,t){if(!t){var n=this.editor.map.addWaypoint({x:+e.x.toFixed(3),y:+e.y.toFixed(3),z:+e.z.toFixed(3)});return{action:"addWaypoint",data:n}}return this.editor.map.removeWaypoint(e.index),{action:"addWaypoint",data:{x:e.x,y:e.y,z:e.z}}}},{key:"removeWaypoint",value:function(e,t){if(!t){if(!this.editor.map.removeWaypoint(e.index))return;return{action:"removeWaypoint",data:e}}return this.editor.map.addWaypoint({waypoint:e}),{action:"removeWaypoint",data:e}}},{key:"selectionAdd",value:function(e,t){return t?(e=this.editor.selection.pop(),{action:"selectionAdd",data:e}):(this.editor.selection.push(e),{action:"selectionAdd"})}},{key:"selectionReplace",value:function(e){var t={action:"selectionReplace",data:this.editor.selection.slice()};return this.editor.selection=e,t}},{key:"selectionRemoveAtIndex",value:function(e,t){return t?(this.editor.selection.splice(e.index,0,e.item),{action:"selectionRemoveAtIndex",data:e.index}):{action:"selectionRemoveAtIndex",data:{index:e,item:this.editor.selection.splice(e,1)[0]}}}},{key:"movedWaypoint",value:function(e,t){var n=e.waypoint,i=e.dragstart,a=e.dragend;return t?(a={x:n.x,z:n.z},n.x=i.x,n.z=i.z,{action:"movedWaypoint",data:{waypoint:n,dragstart:i,dragend:a}}):(a&&(n.x=a.x,n.z=a.z),{action:"movedWaypoint",data:{waypoint:n,dragstart:i}})}},{key:"alignWpts",value:function(e,t){var n=e.wpts,i=e.start,a=e.end,s=e.movedWpts,o=e.highlightEventType;if(o)return"mouseenter"===o&&(this.editor.preview={line:[i,a]}),void("mouseleave"===o&&(this.editor.preview=null));if(n&&!t){var r=[];return n.forEach((function(e){if(e!==i&&e!==a){var t=$(e,i,a);t&&(t.x=+t.x.toFixed(3),t.z=+t.z.toFixed(3),t.x===e.x&&t.z===e.z||(r.push({wpt:e,original:{x:e.x,z:e.z}}),e.x=t.x,e.z=t.z))}})),r.length?(this.editor.lastAlignment={start:i,end:a},{action:"alignWpts",data:{movedWpts:r}}):void 0}var c=[];return s.forEach((function(e){var t=e.wpt,n=e.original;c.push({wpt:t,original:{x:t.x,z:t.z}}),t.x=n.x,t.z=n.z})),{action:"alignWpts",data:{movedWpts:c}}}},{key:"linkWayPointsToggle",value:function(e){var t=e[0],n=e[1],i=e[2],a=t.linkType(n.index),s=n.linkType(t.index);if(null===a&&null===s)t.outs.push(n.index),i||n.ins.push(t.index);else if("out"===a&&"in"===s||"reverse-out"===a&&"reverse-in"===s){var o=t.outs.indexOf(n.index);-1!==o&&t.outs.splice(o,1);var r=n.ins.indexOf(t.index);-1!==r&&n.ins.splice(r,1)}else if("in"===a&&"out"===s||"reverse-in"===a&&"reverse-out"===s)t.outs.push(n.index),n.ins.push(t.index);else{var c=t.outs.indexOf(n.index);-1!==c&&t.outs.splice(c,1);var l=n.ins.indexOf(t.index);-1!==l&&n.ins.splice(l,1)}return{action:"linkWayPointsToggle",data:e}}},{key:"toggleBranchLinkType",value:function(e){var t=e.branch,n=e.option,i=e.original,a=e.highlightEventType;if(!a){if(!i){var s=!1;if(!n)return;if(("oneWay"===n&&t.bidirectional||("twoWay"===n||"switchDirection"===n)&&!t.bidirectional&&!t.reverse||"toggleReverse"===n&&!t.bidirectional)&&(s=!0),!s)return;var o,r=t.wpts.map((function(e){return{wpt:e,ins:e.ins.slice(0),outs:e.outs.slice(0)}}));return t.wpts.forEach((function(e){if(o&&("oneWay"===n&&(o.ins.splice(o.ins.indexOf(e.index),1),e.outs.splice(e.outs.indexOf(o.index),1)),"twoWay"!==n&&"switchDirection"!==n||(o.ins.push(e.index),e.outs.push(o.index)),"switchDirection"===n&&(o.outs.splice(o.outs.indexOf(e.index),1),e.ins.splice(e.ins.indexOf(o.index),1)),"toggleReverse"===n)){var t=e.ins.indexOf(o.index);-1===t?e.ins.push(o.index):e.ins.splice(t,1)}o=e})),{action:"toggleBranchLinkType",data:{original:r}}}var c=i.map((function(e){var t=e.wpt;return{wpt:t,ins:t.ins.slice(0),outs:t.outs.slice(0)}}));return i.forEach((function(e){e.wpt.ins=e.ins,e.wpt.outs=e.outs})),{action:"toggleBranchLinkType",data:{original:c}}}}}]),e}(),q=function(){function e(t){Object(u["a"])(this,e),Object(p["a"])(this,"executor",void 0),Object(p["a"])(this,"actions",void 0),Object(p["a"])(this,"redoables",void 0),Object(p["a"])(this,"map",void 0),Object(p["a"])(this,"selection",void 0),Object(p["a"])(this,"toolsAvailable",void 0),Object(p["a"])(this,"preview",void 0),this.executor=new U(this),this.actions=[],this.redoables=[],this.map=t,this.selection=[],this.toolsAvailable=[],this.preview=null}return Object(d["a"])(e,[{key:"undo",value:function(){var e=this;if(this.actions.length){var t=this.actions.pop();this.redoables.push({rebuildBranches:t.rebuildBranches,label:t.label,actions:t.actions.slice(0).reverse().map((function(t){var n=t.action,i=t.data;return e.executor[n](i,!0)}))}),t.rebuildBranches&&this.mapRebuildBranches(),this.updateAvilableTools()}}},{key:"redo",value:function(){var e=this;if(this.redoables.length){var t=this.redoables.pop();this.actions.push({rebuildBranches:t.rebuildBranches,label:t.label,actions:t.actions.map((function(t){var n=t.action,i=t.data;return e.executor[n](i,!1)}))}),t.rebuildBranches&&this.mapRebuildBranches(),this.updateAvilableTools()}}},{key:"mapRebuildBranches",value:function(){this.selection=this.selection.filter((function(e){var t=e.branch;return!t})),this.map.buildBranches()}},{key:"doneaction",value:function(e){return!!e&&(this.actions.push(e),this.redoables=[],e.rebuildBranches&&this.mapRebuildBranches(),this.updateAvilableTools(),!0)}},{key:"updateAvilableTools",value:function(){var e=this;this.toolsAvailable=[];var t,n,i,a=this.selectionWaypointsAndBranches(),s=a.wpts,o=a.branches,r=[];if(s.length>2&&r.push({label:"Selection 1st and last",data:{start:s[0],end:s.slice(-1)[0],wpts:s.slice(1,-1)},description:"Align "+s.length+" wpts in selection along a line from # "+s[0].index+" to #"+s.slice(-1)[0].index}),s.length&&this.lastAlignment&&this.lastAlignment.start!==s[0]&&this.lastAlignment.end!==s[0]&&this.lastAlignment.start!==s.slice(-1)[0]&&this.lastAlignment.end!==s.slice(-1)[0]){var c=s.filter((function(t){return t.index!==e.lastAlignment.start.index&&t.index!==e.lastAlignment.end.index}));c.length&&r.push({label:"Prev. 1st and last",data:{start:this.lastAlignment.start,end:this.lastAlignment.end,wpts:s},description:"Align "+s.length+" wpts in selection along a line from # "+this.lastAlignment.start.index+" to #"+this.lastAlignment.end.index})}r.length&&(1===r.length?(t=r[0].description,n=r[0].data):i=r,this.toolsAvailable.push({icon:"settings_ethernet",label:"Align waypoints",description:t,action:"alignWpts",data:n,options:i}));if(1===o.length&&1===this.selection.length){var l=o[0],u=[];l.bidirectional&&u.push({label:"One way",value:"oneWay",icon:"arrow_right_alt"}),l.bidirectional||(l.reverse||(u.push({label:"Bidirectional",value:"twoWay",icon:"compare_arrows"}),u.push({label:"Opposite direction",value:"switchDirection",icon:"cached"})),u.push({label:(l.reverse?"Forward":"Reverse")+" driving",value:"toggleReverse",icon:"swap_horizontal_circle"}));var d,p="timeline",h="Change all links in branch # "+o[0].index+" to ";1===u.length?(p=u[0].icon,h+=u[0].label,d=u[0].value,u=null):h+=" selected type",this.toolsAvailable.push({icon:p,label:"Change branch type",description:h,action:"toggleBranchLinkType",options:u,data:{branch:l,option:d},rebuildBranches:!0})}}},{key:"toolAction",value:function(e,t,n){var i=e.action,a=e.data,s=e.label,o=e.rebuildBranches;t&&(void 0!==t.data&&(a=t.data),void 0!==t.value&&(a.option=t.value)),a.highlightEventType=n;var r=this.executor[i](a);r&&this.doneaction({label:s,actions:[r],rebuildBranches:o})}},{key:"selectionWaypointsAndBranches",value:function(){var e=[],t=[];return this.selection.forEach((function(n){n&&n.waypoint&&!e.find((function(e){return e.index===n.waypoint.index}))&&e.push(n.waypoint),n&&n.branch&&(t.find((function(e){return e.index===n.branch.index}))||(t.push(n.branch),n.branch.wpts.forEach((function(t){e.find((function(e){return e.index===t.index}))||e.push(t)}))))})),{wpts:e,branches:t}}},{key:"deleteKeyAction",value:function(e){return"Delete"===e.code&&!e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey&&!e.repeat}},{key:"keyUp",value:function(e){var t,n=this;if(this.deleteKeyAction(e)){var i=this.selectionWaypointsAndBranches(),a=i.wpts;if(!a.length)return;var s=[this.executor.selectionReplace([])];a.forEach((function(e){var t=n.executor.removeWaypoint(e);t&&s.push(t)})),t={label:"Remove selected items",actions:s,rebuildBranches:!0}}if(e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey&&!e.repeat){if("KeyZ"===e.code)return this.undo(),!0;if("KeyY"===e.code)return this.redo(),!0;if("KeyS"===e.code)return this.map.save(),!0}return this.doneaction(t)}},{key:"wptDragged",value:function(e){var t=e.waypoint,n=e.dragstart;this.doneaction({label:"Move Waypont # "+t.index,actions:[this.executor.movedWaypoint({waypoint:t,dragstart:n})]})}},{key:"mapClick",value:function(e){var t,n=e.event,i=e.svgpoint;if(!this.selection.length||n.ctrlKey||n.shiftKey||n.altKey||n.metaKey||(t={label:"Empty selection",actions:[this.executor.selectionReplace([])]}),n.ctrlKey&&!n.shiftKey&&!n.altKey&&!n.metaKey){var a=this.map.waypointsArray().sort((function(e,t){return Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.z-i.y,2))-Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.z-i.y,2))})).slice(0,2);a=a.length?a.reduce((function(e,t){return e+t.y}),0)/a.length:0,t={label:"Add new Waypoint",actions:[this.executor.addWaypoint({x:+i.x.toFixed(3),y:+a.toFixed(3),z:+i.y.toFixed(3)})]}}this.doneaction(t)}},{key:"mouseReplaceSelectionAction",value:function(e,t){var n,i;if(!(this.selection.length&&e.ctrlKey||e.shiftKey||e.altKey))return t.waypoint?(n="waypoint",i=t.waypoint.index):t.branch&&(n="branch",i=t.branch.index),{label:"Set "+n+" # "+i+" as selection",actions:[this.executor.selectionReplace([t])]}}},{key:"mouseAddToSelectionAction",value:function(e,t){if(this.selection.length&&e.ctrlKey&&!e.shiftKey&&!e.altKey){var n,i,a;t.waypoint?(n="waypoint",i=t.waypoint.index):t.branch&&(n="branch",i=t.branch.index);var s=this.selection.findIndex((function(e){return t.waypoint&&e.waypoint===t.waypoint||t.branch&&e.branch===t.branch}));return a=-1!==s?1===this.selection.length?{label:"Empty selection",actions:[this.executor.selectionReplace([])]}:{label:"Remove "+n+" # "+i+" from selection",actions:[this.executor.selectionRemoveAtIndex(s)]}:{label:"Add "+n+" # "+i+" to selection",actions:[this.executor.selectionAdd(t)]},a}}},{key:"selectionMouseActions",value:function(e,t){var n=this.mouseAddToSelectionAction(e,t);return n||(n=this.mouseReplaceSelectionAction(e,t)),n}},{key:"branchClick",value:function(e){var t=e.event,n=e.branch,i={branch:n},a=this.selectionMouseActions(t,i);this.doneaction(a)}},{key:"wptClick",value:function(e){var t=e.event,n=e.waypoint,i={waypoint:n},a=this.selectionMouseActions(t,i);if(!a&&1===this.selection.length&&this.selection.slice(0)[0].waypoint&&this.selection.slice(0)[0].waypoint.index!==n.index&&!t.ctrlKey&&t.shiftKey){var s=this.selection.slice(0)[0].waypoint;a={label:"Toggle Link # "+s.index+" -> # "+n.index,actions:[this.executor.linkWayPointsToggle([s,n,t.altKey])],rebuildBranches:!0}}this.doneaction(a)}}]),e}(),X={name:"App",components:{Card:N,LoadRoute:O,Map:F},data:function(){return{editor:null,mapImageURL:null,mapLoading:!1,error:null,defaultMapSizes:{2048:"default",4096:"4x",8192:"8x"},highlight:{selection:null}}},computed:{selectionWithHL:function(){var e=this;return this.editor.selection.map((function(t,n){return t.highlight=e.highlight.selection===n,t}))},factor:function(){return this.editor&&this.editor.map.size?this.defaultMapSizes[this.editor.map.size]?this.defaultMapSizes[this.editor.map.size]:"custom":null}},mounted:function(){var e=this;window.addEventListener("keydown",(function(t){e.editor&&e.editor.keyUp(t)&&(e.highlight.selection=null,t.preventDefault())}))},methods:{saveMap:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.editor&&e.editor.map){t.next=2;break}return t.abrupt("return");case 2:e.editor.map.save();case 3:case"end":return t.stop()}}),t)})))()},mapLoaded:function(e){this.error=e.error,e.map&&(this.editor=new q(e.map))},undo:function(){this.editor.undo()},redo:function(){this.editor.redo()},toolAction:function(e,t){this.editor.toolAction(e,t)},mapClick:function(e){var t=e.event,n=e.svgpoint;this.editor.mapClick({event:t,svgpoint:n})},branchClick:function(e){this.editor.branchClick(e)},wptClick:function(e){this.editor.wptClick(e)},wptDragged:function(e){this.editor.wptDragged(e)},mouseOver:function(e,t,n){if("selection"===e){var i=n.selIndex;return"mouseenter"===t.type&&(this.highlight.selection=i),void("mouseleave"===t.type&&(this.highlight.selection=null))}if("toolInstance"!==e);else{var a=n.toolInstance,s=n.option;this.editor.toolAction(a,s,t.type)}}}},Y=X,H=(n("b328"),Object(k["a"])(Y,s,o,!1,null,"40f5691b",null)),Z=H.exports;i["a"].use(a["a"]),n("d4b8"),n("c789"),i["a"].config.productionTip=!1,new i["a"]({render:function(e){return e(Z)}}).$mount("#app")},b328:function(e,t,n){"use strict";var i=n("cadb"),a=n.n(i);a.a},b774:function(e,t,n){},ba8c:function(e,t,n){},cadb:function(e,t,n){},d555:function(e,t,n){"use strict";var i=n("15e9"),a=n.n(i);a.a}});
//# sourceMappingURL=app.4e975c6b.js.map