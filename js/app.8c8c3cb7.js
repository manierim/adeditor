(function(e){function t(t){for(var n,o,r=t[0],l=t[1],c=t[2],u=0,p=[];u<r.length;u++)o=r[u],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&p.push(s[o][0]),s[o]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);d&&d(t);while(p.length)p.shift()();return a.push.apply(a,c||[]),i()}function i(){for(var e,t=0;t<a.length;t++){for(var i=a[t],n=!0,o=1;o<i.length;o++){var l=i[o];0!==s[l]&&(n=!1)}n&&(a.splice(t--,1),e=r(r.s=i[0]))}return e}var n={},s={app:0},a=[];function o(e){return r.p+"js/"+({dds:"dds"}[e]||e)+"."+{"chunk-2d0e1d75":"e3425f6a","chunk-7e07bcb6":"c7f391f6",dds:"6830a1a4"}[e]+".js"}function r(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.e=function(e){var t=[],i=s[e];if(0!==i)if(i)t.push(i[2]);else{var n=new Promise((function(t,n){i=s[e]=[t,n]}));t.push(i[2]=n);var a,l=document.createElement("script");l.charset="utf-8",l.timeout=120,r.nc&&l.setAttribute("nonce",r.nc),l.src=o(e);var c=new Error;a=function(t){l.onerror=l.onload=null,clearTimeout(u);var i=s[e];if(0!==i){if(i){var n=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+n+": "+a+")",c.name="ChunkLoadError",c.type=n,c.request=a,i[1](c)}s[e]=void 0}};var u=setTimeout((function(){a({type:"timeout",target:l})}),12e4);l.onerror=l.onload=a,document.head.appendChild(l)}return Promise.all(t)},r.m=e,r.c=n,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/adeditor/",r.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],c=l.push.bind(l);l.push=t,l=l.slice();for(var u=0;u<l.length;u++)t(l[u]);var d=c;a.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"034f":function(e,t,i){"use strict";var n=i("85ec"),s=i.n(n);s.a},"0cd4":function(e,t,i){},1:function(e,t){},"15e9":function(e,t,i){},2:function(e,t){},"50cd":function(e,t,i){"use strict";var n=i("0cd4"),s=i.n(n);s.a},"56d7":function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("2b0e"),s=i("e37d"),a=(i("6672"),i("d4b8"),i("c789"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"flex flex-row h-screen w-screen items-stretch",attrs:{id:"app"}},[i("div",{staticClass:"flex flex-grow-0 flex-col items-stretch p-2",staticStyle:{width:"16em"}},[i("Card",{staticClass:"flex-grow-0 mb-2",scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Files ")]},proxy:!0}])},[i("LoadRoute",{attrs:{cansave:!e.mapLoading&&!!e.editor},on:{"loading-status":function(t){e.mapLoading=t},"map-image-change":function(t){e.mapImageURL=t},"map-xml-loaded":e.mapLoaded,"save-map":e.saveMap}}),e.error?i("div",{staticClass:"flex"},[i("span",{staticClass:"text-red-600 font-bold w-full ",domProps:{textContent:e._s(e.error)}})]):e._e()],1),!e.mapLoading&&e.editor?[e.editor.selection.length?i("Card",{staticClass:"flex-grow-0 mb-2",attrs:{collapsable:!1},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Selected items ")]},proxy:!0}],null,!1,982736498)},[i("ul",e._l(e.editor.selection,(function(t,n){return i("li",{key:e.selectionItemKey(t),on:{mouseenter:function(i){return e.mouseOver("selection",i,{item:t})},mouseleave:function(i){return e.mouseOver("selection",i,{item:t})}}},[i("v-popover",{staticClass:"v-popover--block cursor-pointer hover:bg-pink-300",attrs:{disabled:0===e.selectionItemCmds(t,n).length,placement:"right",openClass:"bg-pink-300",popoverInnerClass:"bg-gray-200 p-2 rounded shadow flex flex-row"}},[i("div",{staticClass:"tooltip-target"},[t.waypoint?i("div",[i("span",[e._v("Waypoint # "+e._s(t.waypoint.index))]),t.waypoint.marker?i("span",{staticClass:"ml-1 font-bold",domProps:{textContent:e._s(t.waypoint.marker.name)}}):e._e()]):e._e(),t.branch?i("div",[i("span",[e._v("Branch # "+e._s(t.branch.index)+" ("+e._s(t.branch.wpts.length)+" wpts)")])]):e._e()]),i("template",{slot:"popover"},e._l(e.selectionItemCmds(t,n),(function(s){return i("div",{key:s.group,staticClass:"flex-col mb-1",on:{mouseenter:function(i){return e.mouseOver("selection",i,{item:t})},mouseleave:function(i){return e.mouseOver("selection",i,{item:t})}}},e._l(s.cmds,(function(s){return i("button",{directives:[{name:"tooltip",rawName:"v-tooltip.right",value:s.label,expression:"cmd.label",modifiers:{right:!0}}],key:s.value,staticClass:"flex bg-gray-300 hover:bg-gray-400 p-1 whitespace-no-wrap",on:{click:function(i){return e.selectionItemCmd({item:t,index:n,cmd:s})}}},[i("span",{staticClass:"material-icons fill-current",domProps:{textContent:e._s(s.icon)}})])})),0)})),0)],2)],1)})),0),i("div",{staticClass:"flex flex-row text-xs"},[e.editor.selection.length?i("button",{staticClass:"m-1 p1 w-full border shadow has-tooltip",on:{click:e.emptySelection}},[e._v(" Empty ")]):e._e(),e.editor.selection.length>1?i("button",{staticClass:"m-1 p1 w-full border shadow has-tooltip",on:{click:e.reverseSelection}},[e._v(" Reverse ")]):e._e()])]):e._e(),i("Card",{staticClass:"flex-grow mb-2",attrs:{collapsable:!1},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Tools ")]},proxy:!0}],null,!1,1256915702)},e._l(e.editor.toolsAvailable,(function(t){return i("div",{key:t.action,staticClass:"flex flex-col self-stretch mb-1",class:{dropdown:t.options}},[i("button",{directives:[{name:"tooltip",rawName:"v-tooltip.right",value:t.description,expression:"toolInstance.description",modifiers:{right:!0}}],staticClass:"inline-flex items-stretch bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-1 px-2 rounded",on:{mouseenter:function(i){t.options||e.mouseOver("toolInstance",i,{toolInstance:t})},mouseleave:function(i){t.options||e.mouseOver("toolInstance",i,{toolInstance:t})},click:function(i){t.options||e.toolAction(t)}}},[i("span",{staticClass:"material-icons fill-current mr-1",domProps:{textContent:e._s(t.icon)}}),i("span",{domProps:{textContent:e._s(t.label)}}),t.options?i("span",[e._v("ðŸ ‹")]):e._e()]),t.options?i("ul",{staticClass:"flex flex-col self-stretch dropdown-content absolute hidden text-gray-800 pt-1 mt-8"},e._l(t.options,(function(n){return i("li",{key:n.index,staticClass:"flex block self-stretch"},[i("button",{directives:[{name:"tooltip",rawName:"v-tooltip.right",value:n.description,expression:"option.description",modifiers:{right:!0}}],staticClass:"flex w-full items-stretch bg-gray-300 hover:bg-gray-400 p-1 whitespace-no-wrap",on:{mouseenter:function(i){return e.mouseOver("toolInstance",i,{toolInstance:t,option:n})},mouseleave:function(i){return e.mouseOver("toolInstance",i,{toolInstance:t,option:n})},click:function(i){return e.toolAction(t,n)}}},[n.icon?i("span",{staticClass:"material-icons fill-current mr-1",domProps:{textContent:e._s(n.icon)}}):e._e(),i("span",{domProps:{textContent:e._s(n.label)}})])])})),0):e._e()])})),0),e.editor&&(e.editor.actions.length||e.editor.redoables.length)?i("Card",{staticClass:"flex-grow-0",scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Undo/Redo ")]},proxy:!0}],null,!1,382143710)},[i("div",{staticClass:"flex flex-row"},[i("div",{staticClass:"flex-1 m-1"},[e.editor.actions.length?i("button",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:e.editor.actions.slice(-1)[0].label,expression:"editor.actions.slice(-1)[0].label",modifiers:{top:!0}}],staticClass:"w-full border shadow",on:{click:e.undo}},[e._v(" Undo ")]):e._e()]),i("div",{staticClass:"flex-1 m-1"},[e.editor.redoables.length?i("button",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:e.editor.redoables.slice(-1)[0].label,expression:"editor.redoables.slice(-1)[0].label",modifiers:{top:!0}}],staticClass:"w-full  border shadow",on:{click:e.redo}},[e._v(" Redo ")]):e._e()])])]):e._e(),i("Card",{staticClass:"flex-grow-0",scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Info ")]},proxy:!0}],null,!1,727986227)},[i("div",{staticClass:"flex flex-col text-sm"},[i("span",{staticClass:"flex text-center"},[i("label",{staticClass:"mr-1",attrs:{for:"mapsize"}},[e._v("Map Size")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.editor.map.size,expression:"editor.map.size"}],attrs:{type:"number",id:"mapsize",list:"sizes"},domProps:{value:e.editor.map.size},on:{input:function(t){t.target.composing||e.$set(e.editor.map,"size",t.target.value)}}}),i("datalist",{attrs:{id:"sizes"}},e._l(e.defaultMapSizes,(function(t,n){return i("option",{key:n,domProps:{value:n,textContent:e._s(t)}})})),0),e.factor?i("span",{staticClass:"ml-1"},[e._v("("+e._s(e.factor)+")")]):e._e()]),i("span",{staticClass:"flex text-center"},[e._v(" Waypoints: "+e._s(e.editor.map.waypointsArray().length)+" ")]),i("span",{staticClass:"flex text-center"},[e._v(" Branches: "+e._s(e.editor.map.branches.length)+" ")])])])]:e._e(),i("Card",[i("div",{staticClass:"text-xs"},[e._v(" For info and help see "),i("a",{staticClass:"font-semibold text-gray-700 underline hover:text-gray-800 hover:no-underline",attrs:{href:"https://github.com/manierim/adeditor#main-features",target:"_blank"}},[e._v("readme on GitHub")])])])],2),!e.mapLoading&&e.editor?i("Map",{staticClass:"flex flex-grow border border-gray-400 rounded shadow-md m-2 ml-0 p-2",attrs:{mapImageURL:e.mapImageURL,editor:e.editor,selection:e.selectionWithHL},on:{"map-click":e.mapClick,"branch-click":e.branchClick,"wpt-click":e.wptClick,"wpt-dragged":e.wptDragged}}):e._e()],1)}),o=[],r=(i("d81d"),i("96cf"),i("1da1")),l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"form flex flex-col text-sm"},[i("div",{staticClass:"flex flex-col mb-2"},[!e.loading&&e.cansave?[i("button",{staticClass:"w-full border shadow",on:{click:function(t){return e.$emit("save-map")}}},[e._v(" Save ")])]:[i("span",{staticClass:"flex text-xs"},[e._v("XML")]),i("input",{staticClass:"flex text-xs",attrs:{disabled:e.loading,type:"file"},on:{change:e.getFile}})]],2),i("div",{staticClass:"flex flex-col"},[e._m(0),i("input",{staticClass:"flex text-xs",attrs:{type:"file"},on:{change:e.getImage}}),e.savePng?[i("a",{staticClass:"w-full border shadow text-center text-xs my-1",attrs:{download:e.saveName.substring(0,e.saveName.length-4)+".png",href:e.savePng}},[e._v(" Download PNG ")]),i("p",{staticClass:"flex text-xs italic"},[e._v(" Conversion from DDS requires time. It is suggested to downnoald the converted PNG image and use it in future. ")])]:e._e()],2)])},c=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("p",{staticClass:"flex text-xs"},[i("span",[e._v("Image")]),i("span",{staticClass:"italic ml-1"},[e._v("(.dds from map or converted .png)")])])}],u=(i("b0c0"),i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),i("4de4"),i("4160"),i("c975"),i("fb6a"),i("90d7"),i("4fad"),i("ac1f"),i("1276"),i("159b"),i("d4ec")),d=i("bee2"),p=i("ade3"),h=(i("99af"),i("6062"),i("2909")),f=function(){function e(t,i,n,s,a,o,r){Object(u["a"])(this,e),Object(p["a"])(this,"map",void 0),Object(p["a"])(this,"index",void 0),Object(p["a"])(this,"x",void 0),Object(p["a"])(this,"y",void 0),Object(p["a"])(this,"z",void 0),Object(p["a"])(this,"marker",void 0),Object(p["a"])(this,"ins",void 0),Object(p["a"])(this,"outs",void 0),this.map=t,this.index=parseInt(i),this.x=parseFloat(n),this.y=parseFloat(s),this.z=parseFloat(a),this.marker=null,this.ins=o,this.outs=r}return Object(d["a"])(e,[{key:"inFromOuts",value:function(){var e=this;return void 0===this.map.cache["inFromOuts"]&&(this.map.cache["inFromOuts"]={},this.map.waypointsArray().forEach((function(t){e.map.cache["inFromOuts"][t.index]||(e.map.cache["inFromOuts"][t.index]=[]),t.existingOuts().forEach((function(i){e.map.cache["inFromOuts"][i]||(e.map.cache["inFromOuts"][i]=[]),e.map.cache["inFromOuts"][i].push(t.index)}))}))),this.map.cache["inFromOuts"]}},{key:"_cache_check",value:function(){void 0===this.map.cache["wpts"]&&(this.map.cache["wpts"]={}),void 0===this.map.cache["wpts"][this.index]&&(this.map.cache["wpts"][this.index]={})}},{key:"set",value:function(e,t){this._cache_check(),this.map.cache["wpts"][this.index][e]=t}},{key:"get",value:function(e,t){return this._cache_check(),void 0!==this.map.cache["wpts"][this.index][e]?this.map.cache["wpts"][this.index][e]:t}},{key:"linksofType",value:function(e){var t=this,i=this.get("linksofType");return void 0===i&&(i={},["in","out","bidirectional","reverse-in","reverse-out"].forEach((function(e){i[e]=t.linkedWpts().filter((function(i){return t.linkType(i)===e}))})),this.set("linksofType",i)),void 0!==e?i[e]:i}},{key:"existingIns",value:function(){var e=this,t=this.get("existingIns");return void 0===t&&(t=this.ins.filter((function(t){return e.map.waypoints[t]})),this.set("existingIns",t)),t}},{key:"existingOuts",value:function(){var e=this,t=this.get("existingOuts");return void 0===t&&(t=this.outs.filter((function(t){return e.map.waypoints[t]})),this.set("existingOuts",t)),t}},{key:"linkType",value:function(e){var t="linkType-"+e,i=this.get(t);return void 0===i&&(i=null,-1!==this.linkedWpts().indexOf(e)&&(i="in",i=-1!==this.existingOuts().indexOf(e)&&-1!==this.existingIns().indexOf(e)?"bidirectional":-1!==this.existingIns().indexOf(e)&&-1!==this.map.waypoints[e].existingOuts().indexOf(this.index)?"in":-1!==this.existingOuts().indexOf(e)&&-1!==this.map.waypoints[e].existingIns().indexOf(this.index)?"out":-1!==this.existingOuts().indexOf(e)?"reverse-out":"reverse-in"),this.set(t,i)),i}},{key:"isNode",value:function(){var e=this.get("isNode");if(void 0===e){e=!0;var t=this.linkedWpts();2===t.length&&(e=!("in"===this.linkType(t[0])&&"out"===this.linkType(t[1])||"out"===this.linkType(t[0])&&"in"===this.linkType(t[1])||"reverse-out"===this.linkType(t[0])&&"reverse-in"===this.linkType(t[1])||"reverse-in"===this.linkType(t[0])&&"reverse-out"===this.linkType(t[1])||"bidirectional"===this.linkType(t[0])&&"bidirectional"===this.linkType(t[1]))),this.set("isNode",e)}return e}},{key:"linkedWpts",value:function(){var e=this.get("linkedWpts");return void 0===e&&(e=Object(h["a"])(new Set([].concat(Object(h["a"])(this.existingIns()),Object(h["a"])(this.existingOuts()),Object(h["a"])(this.inFromOuts()[this.index])))),this.set("linkedWpts",e)),e}},{key:"branches",value:function(){return this.get("branches",[])}},{key:"addBranch",value:function(e){var t=this.get("branches",[]);t.push(e),this.set("branches",t)}}]),e}(),v=function(){function e(t){var i=this;Object(u["a"])(this,e),Object(p["a"])(this,"parser",void 0),Object(p["a"])(this,"cache",void 0),Object(p["a"])(this,"waypoints",void 0),Object(p["a"])(this,"size",void 0),Object(p["a"])(this,"branches",void 0),Object(p["a"])(this,"lastid",void 0),this.parser=t,this.cache={},this.waypoints={},this.lastid=0;for(var n=this.parser.parse(),s=0,a=0;a<n.x.length;a++){Math.abs(n.x[a])>s&&(s=Math.abs(n.x[a])),Math.abs(n.z[a])>s&&(s=Math.abs(n.z[a]));var o=a+1;n.id&&(o=parseInt(n.id[a]));var r=function(e){return e.split(",").map((function(e){return parseInt(e)})).filter((function(e){return e>0}))},l=new f(this,o,parseFloat(n.x[a]),parseFloat(n.y[a]),parseFloat(n.z[a]),r(n.ins[a]),r(n.outs[a]));this.waypoints[o]=l,o>this.lastid&&(this.lastid=o)}var c=2048;s&&(c=2048*Math.pow(2,Math.ceil(Math.log2(Math.ceil(s/1024))))),this.size=c,n.markers.forEach((function(e){i.waypoints[e.index].marker=e})),this.buildBranches()}return Object(d["a"])(e,[{key:"addWaypoint",value:function(e){var t=e.waypoint,i=e.x,s=e.y,a=e.z;if(!t){var o=++this.lastid;t=new f(this,o,parseFloat(i),parseFloat(s),parseFloat(a),[],[])}return n["a"].set(this.waypoints,t.index,t),this.cache["inFromOuts"]&&(this.cache["inFromOuts"][t.index]=[]),t}},{key:"removeWaypoint",value:function(e){if(this.waypoints[e])return n["a"].delete(this.waypoints,e),!0}},{key:"waypointsArray",value:function(){return Object.entries(this.waypoints).map((function(e){return e[1]}))}},{key:"markers",value:function(){return this.waypointsArray().filter((function(e){return e.marker})).map((function(e){return e.marker.wpt=e,e.marker}))}},{key:"save",value:function(){var e=this.parser.getContentForSave(this.waypointsArray(),this.markers()),t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",this.parser.fileName),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}},{key:"buildBranches",value:function(){var e=this;if(this.waypointsArray().length){var t=[];this.cache={};var i=[],n=[],s=function(s){-1===n.indexOf(s.index)&&(n.push(s.index),["bidirectional","out","reverse-out"].forEach((function(n){s.linksofType(n).forEach((function(a){if("bidirectional"!==n||-1===i.indexOf(a)){var o=[s],r=e.waypoints[a];if(r){o.push(r);var l=s;while(r&&!r.isNode()&&r.index!==s.index){l=r;var c=r.linkedWpts().filter((function(e){return e!==o.slice(-2,-1)[0].index}))[0];r=e.waypoints[c],r?o.push(r):console.warn("cannot find waypoint #",c)}"bidirectional"===n&&i.push(l.index);var u={index:t.length,bidirectional:"bidirectional"===n,reverse:"reverse-out"===n,wpts:o};o.forEach((function(e){e.addBranch(u)})),t.push(u)}else console.warn("cannot find waypoint #",a)}}))})))},a=[];this.waypointsArray().forEach((function(t){if(t.linkedWpts().length&&-1===a.indexOf(t.index)){var i=[],n=null;while(!t.isNode()&&-1===i.indexOf(t.index)){a.push(t.index),i.push(t.index);var o=t.linkedWpts()[0];null!==n&&o===n&&(o=t.linkedWpts()[1]),n=t.index,t=e.waypoints[o]}s(t)}})),this.branches=t}else this.branches=[]}}]),e}();function m(e,t){return g.apply(this,arguments)}function g(){return g=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){var s,a,o,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s={map:null,error:null},a=i("083c").parseStringPromise,e.prev=2,e.next=5,a(t);case 5:o=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e["catch"](2),s.error=e.t0,e.abrupt("return",s);case 12:if(!o.AutoDrive){e.next=16;break}return e.next=15,i.e("chunk-7e07bcb6").then(i.bind(null,"6586"));case 15:r=e.sent;case 16:if(!o.routeExport){e.next=20;break}return e.next=19,i.e("chunk-2d0e1d75").then(i.bind(null,"7bc7"));case 19:r=e.sent;case 20:if(r){e.next=23;break}return s.error="File format not recognized",e.abrupt("return",s);case 23:return s.map=new v(new r.default(o,n)),e.abrupt("return",s);case 25:case"end":return e.stop()}}),e,null,[[2,8]])}))),g.apply(this,arguments)}var x,b=function(){return i.e("dds").then(i.bind(null,"e01f"))},y={name:"LoadRoute",data:function(){return{loading:!1,savePng:null,saveName:null}},props:{cansave:Boolean},methods:{loadingStatus:function(e){e!==this.loading&&(this.loading=e,this.$emit("loading-status",e))},getImage:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:"image/vnd.ms-dds"===e.target.files[0].type&&(s=new FileReader,s.onload=function(){var i=Object(r["a"])(regeneratorRuntime.mark((function i(n){var s,a,o;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,b();case 2:return s=i.sent,a=s.createObjectURLFromDDS,i.next=6,a(n.target.result);case 6:o=i.sent,o&&(t.savePng=o,t.saveName=e.target.files[0].name,t.$emit("map-image-change",o));case 8:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}(),s.readAsArrayBuffer(e.target.files[0])),"image/png"===e.target.files[0].type&&(n=URL.createObjectURL(e.target.files[0]),n&&(t.savePng=null,t.$emit("map-image-change",n)));case 2:case"end":return i.stop()}}),i)})))()},getFile:function(e){var t=this;this.loadingStatus(!0);var i=e.target.files[0],n=new FileReader;n.onload=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loadingStatus(!1),e.t0=t,e.next=4,m(n.target.result,i.name);case 4:e.t1=e.sent,e.t0.$emit.call(e.t0,"map-xml-loaded",e.t1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.readAsText(i)}}},w=y,k=i("2877"),_=Object(k["a"])(w,l,c,!1,null,"36fefc3e",null),C=_.exports,O=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("svg",{ref:"svgMap",staticClass:"flex flex-grow bg-gray-200",attrs:{id:"svgMap"},on:{mousemove:e.mapMouseMove}},[i("g",{staticClass:"svg-pan-zoom_viewport"},[i("g",{attrs:{"pointer-events":"fill"},on:{mousedown:e.mouseBtn,mouseup:e.mouseBtn,mousemove:e.mouseBtn}},[i("polygon",{staticClass:"mapbounds",attrs:{id:"mapbounds",fill:"transparent",points:e.mapBoundsPoints}}),e.mapImageURL?i("image",{attrs:{x:-e.editor.map.size/2,y:-e.editor.map.size/2,width:e.editor.map.size,height:e.editor.map.size,href:e.mapImageURL}}):e._e()]),i("g",{staticClass:"targets"},e._l(e.editor.map.markers(),(function(t){return i("text",{key:t.index,staticClass:"marker-label",attrs:{"text-anchor":"middle",x:t.wpt.x,y:t.wpt.z-4}},[e._v(" "+e._s(t.name)+" "),t.folder?i("title",{domProps:{textContent:e._s(t.folder)}}):e._e()])})),0),i("g",{staticClass:"branches"},[i("defs",[i("marker",{attrs:{id:"arrow",markerWidth:".5",markerHeight:".5",refX:"-.4",refY:".25",orient:"auto",markerUnits:"strokeWidth"}},[i("path",{attrs:{d:"M0,0 L.5,.25 L0,.5"}})])]),e._l(e.drawnBranches,(function(t,n){return i("g",{key:n},[e.debug?i("title",[e._v("branch # "+e._s(n))]):e._e(),i("path",{staticClass:"branch",class:t.bidirectional?"bidirectional":t.reverse?"reverse":"unidirectional",attrs:{d:t.d},on:{click:function(i){return e.$emit("branch-click",{event:i,branch:t.original})}}})])})),e.branchsInEditing?i("g",{staticClass:"editing"},e._l(e.branchsInEditing,(function(e){return i("path",{key:e.sindex,staticClass:"branch",attrs:{d:e.d}})})),0):e._e()],2),i("g",{staticClass:"waypoints"},e._l(e.editor.map.waypointsArray(),(function(t){return i("g",{key:t.index},[e.debug||t.marker?i("title",[e._v(" "+e._s(t.marker?(t.marker.folder?t.marker.folder+" / ":"")+t.marker.name+(e.debug?" | ":""):"")+" "+e._s(e.debug?"wpt # "+t.index+" @ "+t.x.toFixed(3)+", "+t.z.toFixed(3)+" ("+t.y.toFixed(3)+")\nBranches:\n"+t.branches().map((function(e){return"# "+e.index})).join("\n"):"")+" ")]):e._e(),i("circle",{class:[t.isNode()?"node":"waypoint",{marker:!!t.marker,draggable:e.wptDragging&&e.wptDragging.dragged&&e.wptDragging.waypoint===t}],attrs:{cx:t.x,cy:t.z,r:t.marker?1.2:t.isNode()?.5:.3},on:{mousedown:function(i){return i.target!==i.currentTarget?null:(i.stopPropagation(),e.wptMouseBtn({event:i,waypoint:t}))},mouseup:function(i){return i.target!==i.currentTarget?null:(i.stopPropagation(),e.wptMouseBtn({event:i,waypoint:t}))},mousemove:function(t){return t.target!==t.currentTarget?null:(t.stopPropagation(),e.mapMouseMove(t))}}})])})),0),i("g",{staticClass:"selection"},[e._l(e.selectedBranches,(function(t,n){var s=t.branch,a=t.highlight;return i("path",{key:n,staticClass:"branch",class:{highlight:a},attrs:{d:s.d},on:{mouseup:function(t){return e.wptMouseBtn({event:t})}}})})),e._l(e.selectedWpts,(function(t){var n=t.waypoint,s=t.highlight;return i("circle",{key:n.index,staticClass:"waypoint",class:{highlight:s,single:1===e.editor.selection.length&&1===e.selectedWpts.length},attrs:{cx:n.x,cy:n.z,r:n.marker?1.4:n.isNode()?.7:.5}})}))],2),e.editor.preview?i("g",{staticClass:"preview"},[this.editor.preview.line?[i("path",{staticClass:"line",attrs:{d:e.pathDef(this.editor.preview.line)}})]:e._e()],2):e._e()])]),i("div",{staticClass:"absolute object-left-top text-xs"},[i("div",{staticClass:"m-2 p-1 bg-gray-200 border border-gray-700 border-solid rounded"},[e.debug?i("div",[e._v(" Segments drawn: "+e._s(e.segments.reduced)+" of "+e._s(e.segments.total)+" ")]):e._e(),e.mouse?i("div",[e._v(" Mouse @ "+e._s(e.mouse.x.toFixed(3))+" "+e._s(e.mouse.y.toFixed(3))+" ")]):e._e(),e.distance?i("div",[e._v("Distance "+e._s(e.distance.toFixed(3)))]):e._e()])])])},z=[],A=(i("a15b"),i("13d5"),i("a434"),i("b680"),i("c1f9"),i("f8f9")),j=i.n(A),M={controlIconsEnabled:!0,dblClickZoomEnabled:!1,zoomScaleSensitivity:.5,minZoom:5e-4,maxZoom:100},I=function(){function e(t){Object(u["a"])(this,e),Object(p["a"])(this,"svgElement",void 0),this.svgElement=t,x&&x.destroy(),x=j()(this.svgElement,M)}return Object(d["a"])(e,[{key:"getSvgPoint",value:function(e){var t=e.x,i=e.y,n=this.svgElement.createSVGPoint();return n.x=t,n.y=i,n.matrixTransform(document.getElementsByClassName("svg-pan-zoom_viewport")[0].getCTM().inverse())}},{key:"resize",value:function(){x.resize()}}]),e}(),R={name:"Map",data:function(){return{debug:!0,leftclicking:null,mouse:null,wptDragging:!1}},props:{editor:Object,selection:Array,mapImageURL:String},computed:{distance:function(){return 2===this.selectedWpts.length?Math.sqrt(Math.pow(this.selectedWpts[0].x-this.selectedWpts[1].x,2)+Math.pow(this.selectedWpts[0].z-this.selectedWpts[1].z,2)):null},selectedBranches:function(){var e=this;return this.selection.filter((function(e){return e&&e.branch})).map((function(t){return t.branch.d=e.pathDef(t.branch.wpts),t}))},selectedWpts:function(){return this.selection.filter((function(e){return e&&e.waypoint}))},branchsInEditing:function(){var e=this;return this.wptDragging&&this.wptDragging.dragged&&this.wptDragging.waypoint?this.wptDragging.waypoint.branches().map((function(t,i){return{index:i,d:e.pathDef(t.wpts)}})):null},drawnBranches:function(){var e=this;return this.editor.map.branches.map((function(t){var i=e.reducePath(t.wpts),n=Object.fromEntries(Object.entries(t));return delete n.wpts,n.segments=t.wpts.length-1,n.reducedsegments=i.length-1,n.d=e.pathDef(i),n.original=t,n}))},segments:function(){return this.drawnBranches.reduce((function(e,t){return{total:e.total+t.segments,reduced:e.reduced+t.reducedsegments}}),{total:0,reduced:0})},mapBoundsPoints:function(){return[[-this.editor.map.size/2,-this.editor.map.size/2].join(","),[this.editor.map.size/2,-this.editor.map.size/2].join(","),[this.editor.map.size/2,this.editor.map.size/2].join(","),[-this.editor.map.size/2,this.editor.map.size/2].join(",")].join(" ")}},methods:{pathDef:function(e){return"M"+e.map((function(e){return[e.x,e.z].join(",")})).join(" L")},mapMouseMove:function(e){this.mouse=this.mouseEventMapCoords(e),0===e.button&&this.wptDragging&&(!this.wptDragging.dragged&&Math.pow(e.movementX,2)+Math.pow(e.movementY,2)>9&&(this.wptDragging.dragged=!0),this.wptDragging.dragged&&(this.wptDragging.waypoint.x=+(this.mouse.x-this.wptDragging.offset.x).toFixed(3),this.wptDragging.waypoint.z=+(this.mouse.y-this.wptDragging.offset.y).toFixed(3)))},wptMouseBtn:function(e){var t=e.event,i=e.waypoint;0===t.button&&("mousedown"===t.type&&i&&(this.wptDragging={waypoint:i,offset:{x:this.mouse.x-i.x,y:this.mouse.y-i.z},dragstart:{x:i.x,z:i.z},dragged:!1}),this.wptDragging&&"mouseup"===t.type&&(this.wptDragging.dragged?this.$emit("wpt-dragged",this.wptDragging):i&&this.$emit("wpt-click",{event:t,waypoint:i}),this.wptDragging=!1))},mouseEventMapCoords:function(e){return this.handler.getSvgPoint({x:e.offsetX,y:e.offsetY})},mouseBtn:function(e){0===e.button&&("mousedown"===e.type&&(this.leftclicking=!0),"mousemove"===e.type&&(this.leftclicking=!1),"mouseup"===e.type&&this.leftclicking&&this.$emit("map-click",{event:e,svgpoint:this.mouseEventMapCoords(e)}))},windowResize:function(){this.handler.resize()},reducePath:function(e){function t(e,t,i){var n=t-e.x,s=i-e.z;return Math.sqrt(Math.pow(n,2)+Math.pow(s,2))}function i(e,i,n){var s=n.x-i.x,a=n.z-i.z,o=s*s+a*a;if(0==o)return this.dist(e,i.x,i.z);var r=((e.x-i.x)*s+(e.z-i.z)*a)/o;return r=Math.max(0,Math.min(1,r)),t(e,i.x+r*s,i.z+r*a)}return e.reduce((function(t,n,s){return s<2?(t.push(n),t):(i(e[s-1],t.slice(-2,-1)[0],n)<.15&&t.splice(-1)[0],t.push(n),t)}),[])}},beforeDestroy:function(){window.removeEventListener("resize",this.windowResize)},mounted:function(){this.handler=new I(this.$refs.svgMap),window.addEventListener("resize",this.windowResize)}},W=R,B=(i("50cd"),Object(k["a"])(W,O,z,!1,null,"6941540f",null)),E=B.exports,S=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"border border-gray-400 rounded shadow-md p-2 flex flex-col"},[e.hasTitle?i("div",{staticClass:"shadow-inner bg-gray-100 rounded flex mb-2",class:{collapsable:e.collapsable},on:{click:function(t){e.collapsable&&(e.collapsed=!e.collapsed)}}},[i("h2",{staticClass:"w-full text-center font-bold uppercase"},[e._t("title"),e.collapsable?[e.collapsed?i("span",[e._v("â‡“")]):i("span",[e._v("â‡‘")])]:e._e()],2)]):e._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.collapsable||!e.collapsed,expression:"!collapsable || !collapsed"}]},[e._t("default")],2)])},T=[],F={props:{collapsable:{type:Boolean,default:!0}},data:function(){return{collapsed:!1}},computed:{hasTitle:function(){return!!this.$slots.title}}},D=F,P=(i("d555"),Object(k["a"])(D,S,T,!1,null,"9c76647a",null)),L=P.exports;i("a4d3"),i("e01a"),i("7db0"),i("c740"),i("38cf");function K(e,t,i){var n={x:i.x-t.x,z:i.z-t.z},s={x:e.x-t.x,z:e.z-t.z},a=n.x*n.x+n.z*n.z,o=s.x*n.x+s.z*n.z,r=Math.min(1,Math.max(0,o/a));if(0!==r&&1!==r)return{x:t.x+n.x*r,z:t.z+n.z*r}}var N=function(){function e(t){Object(u["a"])(this,e),Object(p["a"])(this,"editor",void 0),this.editor=t}return Object(d["a"])(e,[{key:"addWaypoint",value:function(e,t){if(!t){var i=this.editor.map.addWaypoint({x:+e.x.toFixed(3),y:+e.y.toFixed(3),z:+e.z.toFixed(3)});return{action:"addWaypoint",data:i}}return this.editor.map.removeWaypoint(e.index),{action:"addWaypoint",data:{x:e.x,y:e.y,z:e.z}}}},{key:"removeWaypoint",value:function(e,t){if(!t){if(!this.editor.map.removeWaypoint(e.index))return;return{action:"removeWaypoint",data:e}}return this.editor.map.addWaypoint({waypoint:e}),{action:"removeWaypoint",data:e}}},{key:"selectionInsert",value:function(e,t){var i=e.index,n=e.item;return t?this.editor.selection.splice(i,1):this.editor.selection.splice(i,0,n),{action:"selectionInsert",data:e}}},{key:"selectionMove",value:function(e){var t=e.index,i=e.toIndex;return t>=this.editor.selection.length&&(t=this.editor.selection.length-1),this.editor.selection.splice(i,0,this.editor.selection.splice(t,1)[0]),{action:"selectionMove",data:{index:i,toIndex:t}}}},{key:"selectionAdd",value:function(e,t){return t?(e=this.editor.selection.pop(),{action:"selectionAdd",data:e}):(this.editor.selection.push(e),{action:"selectionAdd"})}},{key:"selectionRemoveItems",value:function(e,t){var i,n=e.start,s=e.count,a=e.removed;if(!t){var o=this.editor.selection.splice(n,s);return{action:"selectionRemoveItems",data:{start:n,removed:o}}}return(i=this.editor.selection).splice.apply(i,[n,0].concat(Object(h["a"])(a))),{action:"selectionRemoveItems",data:{start:n,count:a.length}}}},{key:"reverseSelection",value:function(){return this.editor.selection.reverse(),{action:"reverseSelection"}}},{key:"selectionReplace",value:function(e){var t={action:"selectionReplace",data:this.editor.selection.slice()};return this.editor.selection=e,t}},{key:"selectionRemoveAtIndex",value:function(e,t){return t?(this.editor.selection.splice(e.index,0,e.item),{action:"selectionRemoveAtIndex",data:e.index}):{action:"selectionRemoveAtIndex",data:{index:e,item:this.editor.selection.splice(e,1)[0]}}}},{key:"movedWaypoint",value:function(e,t){var i=e.waypoint,n=e.dragstart,s=e.dragend;return t?(s={x:i.x,z:i.z},i.x=n.x,i.z=n.z,{action:"movedWaypoint",data:{waypoint:i,dragstart:n,dragend:s}}):(s&&(i.x=s.x,i.z=s.z),{action:"movedWaypoint",data:{waypoint:i,dragstart:n}})}},{key:"alignWpts",value:function(e,t){var i=e.wpts,n=e.start,s=e.end,a=e.movedWpts,o=e.highlightEventType;if(o)return"mouseenter"===o&&(this.editor.preview={line:[n,s]}),void("mouseleave"===o&&(this.editor.preview=null));if(i&&!t){var r=[];return i.forEach((function(e){if(e!==n&&e!==s){var t=K(e,n,s);t&&(t.x=+t.x.toFixed(3),t.z=+t.z.toFixed(3),t.x===e.x&&t.z===e.z||(r.push({wpt:e,original:{x:e.x,z:e.z}}),e.x=t.x,e.z=t.z))}})),r.length?(this.editor.lastAlignment={start:n,end:s},{action:"alignWpts",data:{movedWpts:r}}):void 0}var l=[];return a.forEach((function(e){var t=e.wpt,i=e.original;l.push({wpt:t,original:{x:t.x,z:t.z}}),t.x=i.x,t.z=i.z})),{action:"alignWpts",data:{movedWpts:l}}}},{key:"linkWayPointsToggle",value:function(e){var t=e[0],i=e[1],n=e[2],s=t.linkType(i.index),a=i.linkType(t.index);if(null===s&&null===a)t.outs.push(i.index),n||i.ins.push(t.index);else if("out"===s&&"in"===a||"reverse-out"===s&&"reverse-in"===a){var o=t.outs.indexOf(i.index);-1!==o&&t.outs.splice(o,1);var r=i.ins.indexOf(t.index);-1!==r&&i.ins.splice(r,1)}else if("in"===s&&"out"===a||"reverse-in"===s&&"reverse-out"===a)t.outs.push(i.index),i.ins.push(t.index);else{var l=t.outs.indexOf(i.index);-1!==l&&t.outs.splice(l,1);var c=i.ins.indexOf(t.index);-1!==c&&i.ins.splice(c,1)}return{action:"linkWayPointsToggle",data:e}}},{key:"toggleBranchLinkType",value:function(e){var t=e.branch,i=e.option,n=e.original,s=e.highlightEventType;if(!s){if(!n){var a=!1;if(!i)return;if(("oneWay"===i&&t.bidirectional||("twoWay"===i||"switchDirection"===i)&&!t.bidirectional&&!t.reverse||"toggleReverse"===i&&!t.bidirectional)&&(a=!0),!a)return;var o,r=t.wpts.map((function(e){return{wpt:e,ins:e.ins.slice(0),outs:e.outs.slice(0)}}));return t.wpts.forEach((function(e){if(o&&("oneWay"===i&&(o.ins.splice(o.ins.indexOf(e.index),1),e.outs.splice(e.outs.indexOf(o.index),1)),"twoWay"!==i&&"switchDirection"!==i||(o.ins.push(e.index),e.outs.push(o.index)),"switchDirection"===i&&(o.outs.splice(o.outs.indexOf(e.index),1),e.ins.splice(e.ins.indexOf(o.index),1)),"toggleReverse"===i)){var t=e.ins.indexOf(o.index);-1===t?e.ins.push(o.index):e.ins.splice(t,1)}o=e})),{action:"toggleBranchLinkType",data:{original:r}}}var l=n.map((function(e){var t=e.wpt;return{wpt:t,ins:t.ins.slice(0),outs:t.outs.slice(0)}}));return n.forEach((function(e){e.wpt.ins=e.ins,e.wpt.outs=e.outs})),{action:"toggleBranchLinkType",data:{original:l}}}}}]),e}(),$=function(){function e(t){Object(u["a"])(this,e),Object(p["a"])(this,"executor",void 0),Object(p["a"])(this,"actions",void 0),Object(p["a"])(this,"redoables",void 0),Object(p["a"])(this,"map",void 0),Object(p["a"])(this,"selection",void 0),Object(p["a"])(this,"toolsAvailable",void 0),Object(p["a"])(this,"preview",void 0),this.executor=new N(this),this.actions=[],this.redoables=[],this.map=t,this.selection=[],this.toolsAvailable=[],this.preview=null}return Object(d["a"])(e,[{key:"undo",value:function(){var e=this;if(this.actions.length){var t=this.actions.pop();this.redoables.push({rebuildBranches:t.rebuildBranches,label:t.label,actions:t.actions.slice(0).reverse().map((function(t){var i=t.action,n=t.data;return e.executor[i](n,!0)})).reverse()}),t.rebuildBranches&&this.mapRebuildBranches(),this.updateAvilableTools()}}},{key:"redo",value:function(){var e=this;if(this.redoables.length){var t=this.redoables.pop();this.actions.push({rebuildBranches:t.rebuildBranches,label:t.label,actions:t.actions.map((function(t){var i=t.action,n=t.data;return e.executor[i](n,!1)}))}),t.rebuildBranches&&this.mapRebuildBranches(),this.updateAvilableTools()}}},{key:"mapRebuildBranches",value:function(){this.selection=this.selection.filter((function(e){var t=e.branch;return!t})),this.map.buildBranches()}},{key:"doneaction",value:function(e){return!!e&&(this.actions.push(e),this.redoables=[],e.rebuildBranches&&this.mapRebuildBranches(),this.updateAvilableTools(),!0)}},{key:"updateAvilableTools",value:function(){var e=this;this.toolsAvailable=[];var t,i,n,s=this.selectionWaypointsAndBranches(),a=s.wpts,o=s.branches,r=[];if(a.length>2&&r.push({label:"Selection 1st and last",data:{start:a[0],end:a.slice(-1)[0],wpts:a.slice(1,-1)},description:"Align "+a.length+" wpts in selection along a line from # "+a[0].index+" to #"+a.slice(-1)[0].index}),a.length&&this.lastAlignment&&this.lastAlignment.start!==a[0]&&this.lastAlignment.end!==a[0]&&this.lastAlignment.start!==a.slice(-1)[0]&&this.lastAlignment.end!==a.slice(-1)[0]){var l=a.filter((function(t){return t.index!==e.lastAlignment.start.index&&t.index!==e.lastAlignment.end.index}));l.length&&r.push({label:"Prev. 1st and last",data:{start:this.lastAlignment.start,end:this.lastAlignment.end,wpts:a},description:"Align "+a.length+" wpts in selection along a line from # "+this.lastAlignment.start.index+" to #"+this.lastAlignment.end.index})}r.length&&(1===r.length?(t=r[0].description,i=r[0].data):n=r,this.toolsAvailable.push({icon:"settings_ethernet",label:"Align waypoints",description:t,action:"alignWpts",data:i,options:n}));if(1===o.length&&1===this.selection.length){var c=o[0],u=[];c.bidirectional&&u.push({label:"One way",value:"oneWay",icon:"arrow_right_alt"}),c.bidirectional||(c.reverse||(u.push({label:"Bidirectional",value:"twoWay",icon:"compare_arrows"}),u.push({label:"Opposite direction",value:"switchDirection",icon:"cached"})),u.push({label:(c.reverse?"Forward":"Reverse")+" driving",value:"toggleReverse",icon:"swap_horizontal_circle"}));var d,p="timeline",h="Change all links in branch # "+o[0].index+" to ";1===u.length?(p=u[0].icon,h+=u[0].label,d=u[0].value,u=null):h+=" selected type",this.toolsAvailable.push({icon:p,label:"Change branch type",description:h,action:"toggleBranchLinkType",options:u,data:{branch:c,option:d},rebuildBranches:!0})}}},{key:"selectionItemCmd",value:function(e){var t,i,n=this,s=e.item,a=e.index,o=e.cmd;if("expand"===o.value){var r=[this.executor.selectionRemoveAtIndex(a)];s.branch.wpts.slice(0).reverse().forEach((function(e){r.push(n.executor.selectionInsert({index:a,item:{waypoint:e}}))})),t={label:"Expand selection branch #"+s.branch.index,actions:r}}if("remove"===o.value&&(t={label:"Remove item from selection",actions:[this.executor.selectionRemoveAtIndex(a)]}),"removeBefore"===o.value||"removeAfter"===o.value){var l="removeBefore"===o.value?0:a+1,c="removeBefore"===o.value?a:this.selection.length-(a+1);t={label:"Remove items from selection",actions:[this.executor.selectionRemoveItems({start:l,count:c})]}}"top"==o.value&&(i=0),"up"==o.value&&(i=a-1),"down"==o.value&&(i=a+1),"bottom"==o.value&&(i=this.selection.length),void 0!==i&&(t={label:o.label+" selection item ",actions:[this.executor.selectionMove({index:a,toIndex:i})]}),this.doneaction(t)}},{key:"toolAction",value:function(e,t,i){var n=e.action,s=e.data,a=e.label,o=e.rebuildBranches;t&&(void 0!==t.data&&(s=t.data),void 0!==t.value&&(s.option=t.value)),s.highlightEventType=i;var r=this.executor[n](s);r&&this.doneaction({label:a,actions:[r],rebuildBranches:o})}},{key:"selectionWaypointsAndBranches",value:function(){var e=[],t=[];return this.selection.forEach((function(i){i&&i.waypoint&&!e.find((function(e){return e.index===i.waypoint.index}))&&e.push(i.waypoint),i&&i.branch&&(t.find((function(e){return e.index===i.branch.index}))||(t.push(i.branch),i.branch.wpts.forEach((function(t){e.find((function(e){return e.index===t.index}))||e.push(t)}))))})),{wpts:e,branches:t}}},{key:"deleteKeyAction",value:function(e){return"Delete"===e.code&&!e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey&&!e.repeat}},{key:"keyUp",value:function(e){var t,i=this;if(this.deleteKeyAction(e)){var n=this.selection.slice(0),s=[this.executor.selectionReplace([])];n.forEach((function(e){var t=e.waypoint,n=e.branch;if(t){var a=i.executor.removeWaypoint(t);a&&s.push(a)}n&&n.wpts.slice(1,-1).forEach((function(e){var t=i.executor.removeWaypoint(e);t&&s.push(t)}))})),t={label:"Remove selected items",actions:s,rebuildBranches:!0}}if(e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey&&!e.repeat){if("KeyZ"===e.code)return this.undo(),!0;if("KeyY"===e.code)return this.redo(),!0;if("KeyS"===e.code)return this.map.save(),!0}return this.doneaction(t)}},{key:"wptDragged",value:function(e){var t=e.waypoint,i=e.dragstart;this.doneaction({label:"Move Waypont # "+t.index,actions:[this.executor.movedWaypoint({waypoint:t,dragstart:i})]})}},{key:"reverseSelection",value:function(){this.doneaction({label:"Reverse selection",actions:[this.executor.reverseSelection()]})}},{key:"emptySelection",value:function(){this.doneaction({label:"Empty selection",actions:[this.executor.selectionReplace([])]})}},{key:"mapClick",value:function(e){var t=e.event,i=e.svgpoint;if(!this.selection.length||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey){var n;if(t.ctrlKey&&!t.shiftKey&&!t.altKey&&!t.metaKey){var s=this.map.waypointsArray().sort((function(e,t){return Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.z-i.y,2))-Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.z-i.y,2))})).slice(0,2);s=s.length?s.reduce((function(e,t){return e+t.y}),0)/s.length:0,n={label:"Add new Waypoint",actions:[this.executor.addWaypoint({x:+i.x.toFixed(3),y:+s.toFixed(3),z:+i.y.toFixed(3)})]}}this.doneaction(n)}else this.emptySelection()}},{key:"mouseReplaceSelectionAction",value:function(e,t){var i,n;if(!(this.selection.length&&e.ctrlKey||e.shiftKey||e.altKey))return t.waypoint?(i="waypoint",n=t.waypoint.index):t.branch&&(i="branch",n=t.branch.index),{label:"Set "+i+" # "+n+" as selection",actions:[this.executor.selectionReplace([t])]}}},{key:"mouseAddToSelectionAction",value:function(e,t){if(this.selection.length&&e.ctrlKey&&!e.shiftKey&&!e.altKey){var i,n,s;t.waypoint?(i="waypoint",n=t.waypoint.index):t.branch&&(i="branch",n=t.branch.index);var a=this.selection.findIndex((function(e){return t.waypoint&&e.waypoint===t.waypoint||t.branch&&e.branch===t.branch}));return s=-1!==a?1===this.selection.length?{label:"Empty selection",actions:[this.executor.selectionReplace([])]}:{label:"Remove "+i+" # "+n+" from selection",actions:[this.executor.selectionRemoveAtIndex(a)]}:{label:"Add "+i+" # "+n+" to selection",actions:[this.executor.selectionAdd(t)]},s}}},{key:"selectionMouseActions",value:function(e,t){var i=this.mouseAddToSelectionAction(e,t);return i||(i=this.mouseReplaceSelectionAction(e,t)),i}},{key:"branchClick",value:function(e){var t=e.event,i=e.branch,n={branch:i},s=this.selectionMouseActions(t,n);this.doneaction(s)}},{key:"wptClick",value:function(e){var t=e.event,i=e.waypoint,n={waypoint:i},s=this.selectionMouseActions(t,n);if(!s&&1===this.selection.length&&this.selection.slice(0)[0].waypoint&&this.selection.slice(0)[0].waypoint.index!==i.index&&!t.ctrlKey&&t.shiftKey){var a=this.selection.slice(0)[0].waypoint;s={label:"Toggle Link # "+a.index+" -> # "+i.index,actions:[this.executor.linkWayPointsToggle([a,i,t.altKey])],rebuildBranches:!0}}this.doneaction(s)}}]),e}(),U={name:"App",components:{Card:L,LoadRoute:C,Map:E},data:function(){return{editor:null,mapImageURL:null,mapLoading:!1,error:null,defaultMapSizes:{2048:"default",4096:"4x",8192:"8x"},highlight:{selection:null}}},computed:{selectionWithHL:function(){var e=this;return this.editor.selection.map((function(t){return t.highlight=e.highlight.selection===e.selectionItemKey(t),t}))},factor:function(){return this.editor&&this.editor.map.size?this.defaultMapSizes[this.editor.map.size]?this.defaultMapSizes[this.editor.map.size]:"custom":null}},mounted:function(){var e=this;window.addEventListener("keydown",(function(t){e.editor&&e.editor.keyUp(t)&&(e.highlight.selection=null,t.preventDefault())}))},methods:{selectionItemKey:function(e){return e.waypoint?"waypoint-"+e.waypoint.index:e.branch?"branch-"+e.branch.index:void 0},selectionItemCmds:function(e,t){var i=[],n=[];t>1&&n.push({label:"Move to top",icon:"vertical_align_top",value:"top"}),t>0&&n.push({label:"Move up",icon:"keyboard_arrow_up",value:"up"});var s=this.editor.selection.length-1;return t<s&&n.push({label:"Move down",icon:"keyboard_arrow_down",value:"down"}),t<s-1&&n.push({label:"Move to bottom",icon:"vertical_align_bottom",value:"bottom"}),n.length&&i.push({group:"move",cmds:n}),e.branch&&i.push({group:"branch",cmds:[{label:"Expand to wapypoints",icon:"open_with",value:"expand"}]}),n=[],t>1&&n.push({label:"Remove all before",icon:"vertical_align_bottom",value:"removeBefore"}),n.push({label:"Remove from selection",icon:"delete",value:"remove"}),t<s&&n.push({label:"Remove all after",icon:"vertical_align_top",value:"removeAfter"}),i.push({group:"remove",cmds:n}),i},emptySelection:function(){this.editor.emptySelection()},reverseSelection:function(){this.editor.reverseSelection()},selectionItemCmd:function(e){this.editor.selectionItemCmd(e)},saveMap:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.editor&&e.editor.map){t.next=2;break}return t.abrupt("return");case 2:e.editor.map.save();case 3:case"end":return t.stop()}}),t)})))()},mapLoaded:function(e){this.error=e.error,e.map&&(this.editor=new $(e.map))},undo:function(){this.editor.undo()},redo:function(){this.editor.redo()},toolAction:function(e,t){this.editor.toolAction(e,t)},mapClick:function(e){var t=e.event,i=e.svgpoint;this.editor.mapClick({event:t,svgpoint:i})},branchClick:function(e){this.editor.branchClick(e)},wptClick:function(e){this.editor.wptClick(e)},wptDragged:function(e){this.editor.wptDragged(e)},mouseOver:function(e,t,i){if("selection"===e){var n=i.item;return"mouseenter"===t.type&&(this.highlight.selection=this.selectionItemKey(n)),void("mouseleave"===t.type&&(this.highlight.selection=null))}if("toolInstance"!==e);else{var s=i.toolInstance,a=i.option;this.editor.toolAction(s,a,t.type)}}}},q=U,G=(i("034f"),i("de28"),Object(k["a"])(q,a,o,!1,null,"4a9a39c4",null)),H=G.exports;n["a"].use(s["a"]),n["a"].config.productionTip=!1,new n["a"]({render:function(e){return e(H)}}).$mount("#app")},6672:function(e,t,i){},"85ec":function(e,t,i){},d555:function(e,t,i){"use strict";var n=i("15e9"),s=i.n(n);s.a},de28:function(e,t,i){"use strict";var n=i("e285"),s=i.n(n);s.a},e285:function(e,t,i){}});
//# sourceMappingURL=app.8c8c3cb7.js.map